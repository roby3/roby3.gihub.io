<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta http-equiv="Content-Language" content="uk">
<link rel=Edit-Time-Data href=14.files/editdata.mso>
<title>4.3.4. Повнодуплексні протоколи локальних мереж</title>
</head>
<body lang=Ua>
<h3>4.3.4. Повнодуплексні протоколи локальних мереж</h3>
<h4><a name=32></a>Зміни в роботі Мас-рівня
при повнодуплексній роботі</h4>
<p>Технологія комутації сама по собі
не має безпосереднього відношення до методу доступу до середовища,
що використовується портами комутатора. При
підключенні сегментів, що представляють собою
поділюване середовище, порт комутатора повинен
підтримувати напівдуплексний режим, тому що є
одним з вузлів цього сегмента.</p>
<p>Однак, коли до кожного порту
комутатора підключений не сегмент, а тільки один
комп'ютер, причому по двох роздільних каналах, як це відбувається майже у всіх
стандартах фізичного рівня, крім коаксіальних версій Ethernet, ситуація стає не
такою однозначною. Порт може працювати як у
звичайному напівдуплексному режимі, так й у повнодуплексному.
Підключення до портів комутатора не сегментів, а окремих комп'ютерів
називається <b><i>мікросегментацією</i></b>.</p>
<p>У звичайному режимі роботи порт
комутатора як і раніше розпізнає колізії. Доменом
колізій у цьому випадку буде ділянка мережі, що включає передавач комутатора, приймач
комутатора, передавач мережного адаптера
комп'ютера, приймач мережного адаптера
комп'ютера й дві кручені
пари, що з'єднують передавачі із приймачами (мал. 4.27).</p>
<table border="0" width="100%" id="table1">
	<tr>
		<td align="center">
<img width=424 height=303 src=images/m27.jpg alt="Мал. 4.27. Домен колізій, утворений комп'ютером і портом комутатора"></td>
	</tr>
	<tr>
		<td align="center">Мал. 4.27. Домен колізій, утворений
комп'ютером і портом комутатора</td>
	</tr>
</table>
<p>Колізія виникає, коли передавачі
порту комутатора й мережного адаптера
одночасно або майже одночасно починають передачу своїх кадрів, вважаючи, що зображений
на малюнку сегмент вільний. Правда, імовірність колізії в такому сегменті
набагато менша, ніж у сегменті, що складається
з 20-30 вузлів, але вона не нульова. При цьому максимальна продуктивність
сегмента Ethernet в 14&nbsp;880 кадрів за секунду при мінімальній довжині кадру
ділиться між передавачем порту комутатора й передавачем мережного адаптера. Якщо вважати,
що вона ділиться навпіл, то кожному надається
можливість передавати приблизно по 7440&nbsp;кадрів у секунду.</p>
<p>У повнодуплексному
режимі одночасна передача даних передавачем порту комутатора і мережного адаптера колізією не вважається. Це досить природній режим роботи для індивідуальних повнодуплексних
каналів зв'язку, і він часто використовується в протоколах територіальних мереж. При повнодуплексному
зв'язку порти Ethernet можуть передавати дані зі швидкістю 20&nbsp;Мбіт/с
- по 10&nbsp;Мбіт/с в кожному напрямку.</p>
<p>Необхідно, щоб Мас-вузли взаємодіючих пристроїв
підтримували цей спеціальний режим. У випадку коли тільки один вузол буде підтримувати повнодуплексний режим, другий вузол буде постійно фіксувати колізії
й припиняти свою роботу, у той час як інший вузол буде продовжувати передавати дані, які ніхто в цей момент не приймає. Зміни, які
потрібно зробити в логіку Мас-вузла, щоб він міг
працювати в повнодуплексному режимі, мінімальні - потрібно просто скасувати фіксацію й відпрацьовування колізій у мережах Ethernet, а в мережах
Token Ring й FDDI - посилати кадри в комутатор, не чекаючи приходу токена доступу, а тоді, коли це потрібно кінцевому вузлу. Фактично, при роботі в повнодуплексному режимі
Мас-вузел не використає
метод доступу до середовища, розроблений для
даної технології.</p>
<p>Тому що перехід на повнодуплексний режим роботи вимагає зміни логіки
роботи Мас-вузлів і драйверів мережевих адаптерів, то він спочатку був
випробуваний при з'єднанні двох комутаторів.
Уже перші моделі комутатора EtherSwitch компанії Kalpana підтримували повнодуплексний режим при взаємному
з'єднанні, забезпечуючи швидкість взаємного
обміну 20&nbsp;Мбіт/с.</p>
<p>Пізніше з'явилися версії повнодуплексного з'єднання
FDDI-комутаторів, які при одночасному
використанні двох кілець FDDI забезпечували
швидкість обміну в 200&nbsp;Мбіт/с.</p>
<p>Зараз для кожної технології можна
знайти моделі комутаторів, які підтримують повнодуплексний
обмін при з'єднанні комутатор-комутатор.</p>
<p>Після випробування повнодуплексної технології на з'єднаннях
комутатор-комутатор розробники реалізували її й у мережевих
адаптерах, в основному адаптерах Ethernet й
Fast Ethernet. При розробці технологій Fast Ethernet й Gigabit Ethernet повнодуплексний режим став одним із двох повноправних
стандартних режимів роботи вузлів мережі.
Багато мережевих адаптерів зараз можуть
підтримувати обидва режими роботи, відпрацьовуючи логікові
алгоритму доступу CSMA/CD при підключенні до порту концентратора й працюючи в повнодуплексному режимі
при підключенні до порту комутатора.</p>
<p>При використанні повнодуплексних версій протоколів відбувається деяке
зближення різних технологій, тому що метод доступу багато в чому визначав особливість
кожної технології. Розходження технологій залишається в різних форматах кадрів, а також у
процедурах контролю коректності роботи мережі
на фізичному й канальному рівнях.</p>
<p>Повнодуплексні версії протоколів могли б бути
реалізовані й у мостах. Принципових перешкод для цього не було, просто в період
застосування локальних мостів потреби у
високошвидкісній передачі міжсегментного трафіка не виникало.</p>
<h4><a name=33></a>Проблема керування
потоком даних при повнодуплексній роботі</h4>
<p>Проста відмова
від підтримки алгоритму доступу до поділюваного середовища
без якої-небудь модифікації протоколу веде до
підвищення ймовірності втрат кадрів комутаторами, тому що при цьому губиться контроль за потоками кадрів, що направляють кінцевими вузлами в мережу. Раніше
потік кадрів регулювався методом доступу до поділюваного середовища, так що занадто часто генерує кадри вузол
змушений був чекати своєї черги до середовища
й фактична інтенсивність потоку даних, що направляв
у мережу цей вузол, була помітно менше тієї інтенсивності, що вузол хотів би відправити в мережу.
При переході на повнодуплексний режим вузлу дозволяється відправляти кадри в комутатор
завжди, коли це йому потрібно, тому комутатори мережі
можуть у цьому режимі зіштовхуватися з перевантаженнями, не маючи при цьому ніяких засобів регулювання (&quot;пригальмовування&quot;)
потоку кадрів.</p>
<p>Причина перевантажень звичайно
криється не в тому, що комутатор блокує, тобто
йому не вистачає продуктивності процесорів для обслуговування потоків кадрів, а
в обмеженій пропускній здатності окремого
порту, що визначається тимчасовими параметрами протоколу. Наприклад, порт Ethernet не
може передавати більше 14&nbsp;880&nbsp;кадрів за секунду, якщо він не порушує тимчасових співвідношень, встановлених
стандартом.</p>
<p>Тому, якщо вхідний трафік
нерівномірно розподіляється між вихідними портами, легко представити ситуацію,
коли в який-небудь вихідний порт комутатора буде направлятися
трафік із сумарною середньою інтенсивністю більшою, ніж протокольний максимум. На мал.&nbsp;4.28
зображена саме така ситуація, коли в порт <b>3</b> комутатора направляється трафік від портів 
<b>1,2,4</b><i></i>й 6,<i></i>із<i></i>сумарною
інтенсивністю в 22&nbsp;100 кадрів за секунду. Порт <b>3</b><i></i>виявляється завантажений на 150%. Природно, що коли
кадри надходять у буфер порту зі швидкістю 20&nbsp;100 кадрів за секунду, а йдуть зі швидкістю
14&nbsp;880 кадрів за секунду, то внутрішній буфер вихідного порту починає
неухильно заповнюватися неопрацьованими кадрами.</p>
<table border="0" width="100%" id="table2">
	<tr>
		<td align="center">
<img width=438 height=424 src=images/m28.jpg alt="Мал. 4.28. Переповнення буфера порту через незбалансований трафік"></td>
	</tr>
	<tr>
		<td align="center">Мал. 4.28. Переповнення буфера порту через незбалансований трафік</td>
	</tr>
</table>
<p>Яким би не був обсяг
буфера порту, він у якийсь момент часу обов'язково переповниться. Неважко
підрахувати, що при розмірі буфера в 100&nbsp;Кбайт
у наведеному прикладі повне заповнення буфера відбудеться через 0,22 секунди після початку
його роботи (буфер такого розміру може зберігати до 1600&nbsp;кадрів розміром в
64&nbsp;байт). Збільшення буфера до 1&nbsp;Мбайту дасть збільшення часу
заповнення буфера до 2,2&nbsp;секунд, що також
неприйнятно. А втрати кадрів завжди дуже небажані, тому що знижують корисну
продуктивність мережі, і комутатор, що губить кадри, може значно погіршити продуктивність мережі замість її поліпшення.</p>
<p>Комутатори локальних мереж - не перші пристрої,
які зіштовхуються з
такою проблемою. Мости також можуть випробовувати
перевантаження, однак такі ситуації при використанні мостів зустрічалися рідко
через невелику інтенсивність міжсегментного трафіка, тому розробники мостів не стали вбудовувати в протоколи локальних мереж або в самі мости механізми регулювання потоку.
У глобальних мережах комутатори технології
Х.25 підтримують протокол канального рівня LAP-B, що має спеціальні кадри керування потоком &quot;Приймач готовий&quot; (<b>RR</b>) і &quot;Приймач не готовий&quot; (<b>RNR</b>), аналогічні по призначенню кадрам протоколу LLC2 (це не дивно, тому
що обидва протоколи належать сімейству протоколів HDLC). Протокол LAP-B працює
між сусідніми комутаторами мережі Х.25 й у
тому випадку, коли черга комутатора доходить
до небезпечної границі, забороняє своїм
найближчим сусідам за допомогою кадру &quot;Приймач не готовий&quot; передавати
йому кадри, поки черга не зменшиться до нормального рівня. У мережах Х.25 такий протокол необхідний, тому що ці мережі ніколи не використовували
поділювані середовища передачі даних, а
працювали по індивідуальних каналах зв'язку в повнодуплексному режимі.</p>
<p>При розробці комутаторів
локальних мереж ситуація докорінно
відрізнялася від ситуації, при якій створювалися комутатори територіальних мереж. Основним завданням
було збереження кінцевих вузлів у незмінному виді,
що виключало коректування протоколів локальних мереж.
А в цих протоколах процедур керування потоком
не було - загальне середовище
передачі даних у режимі поділу часу виключав виникнення ситуацій, коли мережа переповнялася б неопрацьованими кадрами. Мережа не накопичувала даних у яких-небудь проміжних
буферах при використанні тільки повторювачів або концентраторів.</p>
<table border="0" cellpadding="2" width="100%" id="table3">
	<tr>
		<td>
<img width=36 height=35 src=images/znak.gif alt="УВАГА!"></td>
		<td><i>Тут мова йде про протоколи МАС-рівня (Ethernet, Token Ring і т. п), тому що мости
й комутатори мають справу тільки з ними. Протокол LLC2, що вміє управляти потоком даних, для цілей керування потоком кадрів у комутаторах використовувати не можна. Для комутаторів протокол
LLC (всієї його процедури: 1,2 й 3) прозорий, як і всі інші протоколи верхніх
рівнів, - комутатор не аналізує заголовок LLC, вважаючи
його просто полем даних кадру Мас-рівня.</i></td>
	</tr>
</table>
<p>Застосування комутаторів без
зміни протоколу роботи встаткування завжди
породжує небезпеку втрати кадрів. Якщо порти
комутатора працюють у звичайному, тобто в
напівдуплексному режимі, то в комутатора є
можливість зробити деякий вплив на кінцевий вузол і змусити
його призупинити передачу кадрів, поки в комутатора не розвантажаться внутрішні буфери.
Нестандартні методи керування потоком у
комутаторах при збереженні протоколу доступу в незмінному вигляді будуть розглянуті нижче.</p>
<p>Якщо ж комутатор працює в повнодуплексному режимі,
то протокол роботи кінцевих вузлів, та і його портів однаково змінюється. Тому мало сенс для підтримки повнодуплексного режиму роботи комутатори трохи
модифікувати протокол взаємодії вузлів, вмонтувавши в нього явний механізм керування потоком кадрів.</p>
<p>Робота над розробкою стандарту для керування
потоком кадрів у повнодуплексных версіях
Ethernet й Fast Ethernet тривала кілька років.</p>
<p>У березні 1997 року прийнятий
стандарт IEEE 802.3x на керування потоком у повнодуплексних версіях протоколу Ethernet. Він визначає досить
просту процедуру керування потоком, подібну тій, котра використовується в протоколах LLC2 й LAP-B. Ця
процедура містить дві команди – &quot;Призупинити
передачу&quot; й &quot;Відновити передачу&quot;, які направляються
сусідньому вузлу. Відмінність
від протоколів типу LLC2 у тому, що ці команди
реалізуються на рівні символів кодів фізичного рівня, таких
як 4В/5В, а
не на рівні команд, оформлених у спеціальні
керуючі кадри. Мережевий адаптер або порт
комутатора, що підтримує стандарт 802.3х і отримавши команду &quot;Призупинити передачу&quot;,
повинен припинити передавати кадри надалі до одержання команди &quot;Відновити
передачу&quot;.</p>
<p>Деякі фахівці висловлюють
побоювання, що така проста процедура керування
потоком виявиться непридатною
в мережах Gigabit Ethernet. Повне припинення прийому кадрів від сусіда при такій великій
швидкості передачі кадрів (1&nbsp;488&nbsp;090&nbsp;кадр/с) може швидко викликати переповнення внутрішнього буфера тепер у цього сусіда, що у свою чергу повністю заблокують прийом
кадрів у своїх найближчих сусідів. Таким
чином, перевантаження просто пошириться по мережі, замість того
щоб поступово зникнути. Для роботи з такими
швидкісними протоколами необхідний більше
тонкий механізм регулювання потоку, який би вказував, на яку величину потрібно зменшити інтенсивність потоку
вхідних кадрів у перевантажений комутатор, а
не припиняв цей потік до нуля. Подібний плавний механізм регулювання потоку
з'явився у комутаторів ATM через кілька років
після їхньої появи. Тому існує думка, що стандарт 802.3х
- це тимчасове рішення,
яке просто закріпило існуючі фірмові прості механізми керування
потоком провідних виробників комутаторів. Пройде якийсь час, і цей стандарт замінить інший стандарт - більше
складний і більш
пристосований для високошвидкісних технологій,
таких як Gigabit Ethernet.</p>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="table1">
  <tr>
    <td width="100%" align="left" colspan="3"><hr color="#2D4C54" size="4"></td>
  </tr>
  <tr>
    <td width="33%" align="left"><a href="013.htm">Попередня</a></td>
    <td width="33%" align="center"><a href="001.htm">Перша</a></td>
    <td width="34%" align="right"><a href="015.htm">Наступна</a></td>
  </tr>
</table>
</body>

</body>
</html>
