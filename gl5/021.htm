<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta http-equiv="Content-Language" content="uk">
<link rel=Edit-Time-Data href=../tmp/5.3.5_Udoc.files/editdata.mso>
<title>5.3.5. Маршрутизація з використанням масок</title>
</head>
<body lang=Ua>
<h3>5.3.5. Маршрутизація з
використанням масок</h3>
<h4><a name=40></a>Використання масок для структуризації мережі</h4>
<p>Алгоритм маршрутизації
ускладнюється, коли в систему адресації вузлів вносяться додаткові елементи -
маски. У чому ж причина відмови від цього
методу адресації заснованого на класах? Таких
причин декілька, і одна з них - потреба в
структуризації мереж.</p>
<p>Часто адміністратори мереж зазнають
незручності через те, що кількість централізовано виділених їм номерів мереж
недостатньо для того, щоб структуризувати мережу належним чином, наприклад розмістити всі слабо взаємодіючі комп'ютери по різних мережах. У такій ситуації можливі два шляхи. Перший з них
пов'язаний з одержанням від InterNIC або постачальника послуг Internet
додаткових номерів мереж. Другий спосіб, що
вживається частіше, пов'язаний з використанням технології масок, що дозволяє поділити одну мережу
на кілька мереж.</p>
<p>Допустимо, адміністратор одержав
у своє розпорядження <b>адресу класу В</b>:<nobr> 129.44.0.0. </nobr>Він може
організувати мережу з
більшим числом вузлів, номера яких він може брати з діапазону <nobr>0.0.0.1</nobr>-<nobr>0.0.255.254</nobr> (з урахуванням того,
що адреси з одних нулів й одних одиниць мають спеціальне призначення й не
годяться для адресації вузлів). Однак йому не потрібна одна велика неструктурована мережа,
виробнича необхідність диктує адміністраторові
інше рішення, відповідно до якого мережа
повинна бути розділена на три окремих підмережі,
при цьому трафік у кожній
підмережі повинен бути надійно локалізований. Це
дозволить легше діагностувати мережу й здійснювати в кожній з підмереж
особливу політику безпеки.</p>
<p>Подивимося, як вирішується ця проблема шляхом використання
механізму масок.</p>
<p>Отже, номер мережі, що адміністратор одержав
від постачальника послуг, - <nobr>129.44.0.0</nobr> (<nobr>10000001 00101100 00000000 00000000</nobr>).
Як маску було обране значення <nobr>255.255.192.0</nobr>
(<nobr>11111111 11111111 11000000 00000000</nobr>). Після накладення маски на цю адресу
число розрядів, інтерпретованих як номер мережі, збільшилося з
16 (стандартна довжина поля номера мережі для класу В) до 18 (число одиниць у масці),
тобто адміністратор одержав можливість використовувати для нумерації підмереж два
додаткових біти. Це дозволяє йому зробити з одного, централізовано заданого йому номера
мережі, чотири:<br><nobr>129.44.0.0 (10000001 00101100 00000000 00000000)</nobr><br>
<nobr>129.44.64.0 (10000001 00101100 01000000 00000000)</nobr><br><nobr>129.44.128.0 (10000001 00101100 10000000 00000000)</nobr><br>
<nobr>129.44.192.0 (10000001 00101100 11000000 00000000)</nobr></p>
<p>Два додаткових останніх біти в номері мережі часто інтерпретуються як номери підмереж (subnet), і тоді чотири
перерахованих вище підмережі
мають номера 0 (00), 1 (01), 2 (10) і 3 (11)
відповідно.</p>
<table border="0" cellpadding="0" cellspacing="1" width="100%" id="table1">
	<tr>
		<td valign="top">
		<img border="0" src="images/znak.gif" width="36" height="35" hspace="5"></td>
		<td><i>Деякі програмні й апаратні маршрутизатори не підтримують номера 
		підмереж, які складаються або тільки з одних нулів, або тільки з одних 
		одиниць. Наприклад, для деяких типів обладнання номер мережі 129.44.0.0 
		з маскою 255.255.192.0, який використовується у нашому прикладі, 
		виявиться неприпустимим, оскільки в цьому випадку розряди в полі номера 
		підмережі мають значення 00. З аналогічних міркувань неприпустимим може 
		виявитися й номер мережі 129.44.192.0 с тим же значенням маски. Тут 
		номер підмережі складається тільки з одиниць. Однак більш сучасні 
		маршрутизатори вільні від цих обмежень. Тому, приймаючи рішення про 
		використання механізму масок, необхідно з'ясувати характеристики того 
		обладнання, яким ви працюєте, щоб відповідним чином зконфігурувати 
		маршрутизатори й комп'ютери мережі.</i></td>
	</tr>
</table>
<p>У результаті використання масок
була запропонована наступна схема розподілу адресного простору (мал. 5.15).</p>
<p>Мережа, що вийшла в результаті проведеної
структуризації, показана на мал. 5.16. Весь трафік
у внутрішню мережу <nobr>129.44.0.0,</nobr> що направляється із зовнішньої мережі,
надходить через маршрутизатор <b>Ml</b>. З метою структуризації
інформаційних потоків у внутрішній мережі
встановлений додатковий маршрутизатор <b>М2</b>.</p>
<p>Всі вузли були розподілені по
трьох різних мережах, яким були привласнені
номери <nobr>129.44.0. 0</nobr>, <nobr>129.44.64. 0</nobr> й <nobr>129.44. 128.0</nobr> і маски однакової довжини —
<nobr>255.255. 192.0. </nobr>Кожна зі знов утворених мереж була підключена до відповідно зконфігурованих портів внутрішнього маршрутизатора 
<b>М2</b>. Крім того, ще одна мережа (номер <nobr>129.44. 192.0</nobr>, маска 
<nobr>255.255. 192.0</nobr>)
була виділена для створення з'єднання між
зовнішнім і внутрішнім маршрутизаторами. Особливо відзначимо, що в цій мережі для адресації вузлів були зайняті всього дві адреси 129.44. 192.1 (порт маршрутизатора 
<b>М2</b>) і <nobr>129.44. 192.2</nobr> (порт
маршрутизатора <b>Ml</b>), ще дві адреси <nobr>129.44. 192.0</nobr> і <nobr>129.44. 192. 255</nobr> є особливими адресами. Отже, величезне число вузлів
(2<sup>14</sup> - 4) у цій підмережі ніяк не використовуються.</p>
<p>Ззовні мережа
як і раніше виглядає, як єдина мережа класу В,
а на місцевому рівні це повноцінна складена мережа, у яку входять три окремі мережі. Загальний трафік, що надходить то мережі, поділяється місцевим маршрутизатором 
<b>М2</b> між цими мережами
відповідно до таблиці маршрутизації. (Зазначимо, що поділ
великої мережі, що має одну адресу старшого
класу, наприклад А або В, за допомогою масок несе в собі ще одну перевагу в порівнянні з використанням декількох адрес стандартних класів для мереж меншого розміру, наприклад С. Він дозволяє
сховати внутрішню структуру мережі
підприємства від зовнішнього спостереження й тим підвищити її безпеку.)</p>
<table border="0" width="100%" id="table2">
	<tr>
		<td align="center">
		<img width=552 height=466 src=images/im015.jpg alt="Мал. 5.15. Поділ адресного простору мережі класу В 129.44.0.0 на чотири рівні частини шляхом використання масок однакової довжини 255.255.192.0"></td>
	</tr>
	<tr>
		<td align="center">Мал. 5.15. Поділ адресного простору мережі <b>класу В</b>
		<nobr>129.44.0.0</nobr> на чотири рівні частини
шляхом використання масок однакової довжини <nobr>255.255.192.0</nobr></td>
	</tr>
</table>
<p>Розглянемо, як змінюється робота модуля IP, коли
стає необхідним враховувати наявність масок.
По-перше, у кожному записі таблиці маршрутизації з'являється нове поле - поле
маски.</p>
<p>По-друге, міняється алгоритм визначення маршруту по таблиці маршрутизації. Після того як IP-адреса витягається із
чергового отриманого IP-пакета, необхідно визначити
адресу наступного маршрутизатора, на який слід
передати пакет із цією адресою. Модуль IP послідовно переглядає всі записи
таблиці маршрутизації. З кожним записом здійснюються наступні дії.</p>
<ul type=disc>
	<li>Маска М, що міститься в даному записі, накладається на IP-адресу вузла призначення, витягнута з пакета.</li>
	<li>Отримане в результаті число є номером мережі призначення пакета, який обробляється. Воно порівнюється з номером мережі, що розміщена у даному записі таблиці маршрутизації.</li>
	<li>Якщо номера мереж збігаються, то пакет передається маршрутизатору, адреса якого розміщена у відповідному полі даного запису.</li>
</ul>
<table border="0" width="100%" id="table3">
	<tr>
		<td align="center">
		<img width=532 height=389 src=images/im016.jpg alt="Мал. 5.16. Маршрутизація з використанням масок однакової довжини"></td>
	</tr>
	<tr>
		<td align="center">Мал. 5.16. Маршрутизація з
використанням масок однакової довжини</td>
	</tr>
</table>
<p>Тепер розглянемо
цей алгоритм на прикладі маршрутизації пакетів у мережі,
зображеній на мал. 5.16. Всі маршрутизатори
зовнішньої мережі, зустрівши пакети з адресами, що починаються з
129.44, інтерпретують їх як адреси класу В і направляють
по маршрутах, що ведуть до маршрутизатора <b>М1</b>. Маршрутизатор <b>М1</b> у свою чергу направляє весь вхідний трафік мережі 
<nobr>129.44.0.0</nobr> на маршрутизатор 
<b>М2</b>, а саме на його порт <nobr>129.44.192.1.</nobr></p>
<p>Маршрутизатор <b>М2</b> обробляє всі
пакети, що надійшли на нього, відповідно до таблиці маршрутизації (табл. 5.12).</p>
<table border=1 width="100%" bordercolorlight="#C0C0C0" bordercolordark="#808080" bordercolor="#C0C0C0">
	<caption style="text-align: left">Таблиця 5.12. Таблиця маршрутизатора М2 у мережі з масками
однакової довжини</caption>
	<tr>
		<th valign=top nowrap bgcolor="#66CCFF">
		Номер мережі</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Маска</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Адреса наступного маршрутизатора</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Адреса порту</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Відстань</th>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44. 0.0</td>
		<td valign=top nowrap>
		255. 255.192.0</td>
		<td valign=top nowrap>
		129.44. 0.1</td>
		<td valign=top nowrap>
		129.44. 0.1</td>
		<td valign=top nowrap>
		Підключена</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44.64.0</td>
		<td valign=top nowrap>
		255. 255.192.0</td>
		<td valign=top nowrap>
		129.44.64.7</td>
		<td valign=top nowrap>
		129.44.64.7</td>
		<td valign=top nowrap>
		Підключена</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44. 128.0</td>
		<td valign=top nowrap>
		255. 255.192.0</td>
		<td valign=top nowrap>
		129.44. 128.5</td>
		<td valign=top nowrap>
		129.44. 128.5</td>
		<td valign=top nowrap>
		Підключена</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44. 192.0</td>
		<td valign=top nowrap>
		255. 255.192.0</td>
		<td valign=top nowrap>
		129.44. 192.1</td>
		<td valign=top nowrap>
		129.44. 192.1</td>
		<td valign=top nowrap>
		Підключена</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		0.0. 0.0</td>
		<td valign=top nowrap>
		0.0. 0.0</td>
		<td valign=top nowrap>
		129.44. 192.2</td>
		<td valign=top nowrap>
		129.44. 192.1</td>
		<td valign=top nowrap>
		—</td>
	</tr>
</table>
<p>Перші чотири
записи в таблиці відповідають внутрішнім підмережам,
безпосередньо підключеним до портів
маршрутизатора <b>М2</b>.</p>
<p>Запис <nobr>0.0.0.0</nobr> з маскою <nobr>0.0.0.0</nobr> відповідає маршруту
за замовчуванням. Дійсно, будь-яка адреса в пакеті, що
прийшов, після накладення на нього маски <nobr>0.0.0.0</nobr> дасть адресу
мережі <nobr>0.0.0.0</nobr>, що збігається з адресою, зазначеною
в записі. Маршрутизатор виконує порівняння з адресою <nobr>0.0.0.0</nobr> в останню чергу, у тому випадку
коли, що прийшла адреса, не дав збігу з жодною
записом у таблиці, що відрізняється від
<nobr>0.0.0.0</nobr>. Записів з адресою <nobr>0.0.0.0</nobr> у таблиці маршрутизації може бути
декілька. У цьому випадку маршрутизатор передає пакет по всіх таких маршрутах.</p>
<p>Нехай, наприклад, з маршрутизатора <b>Ml</b> на порт <nobr>129.44.192.1</nobr> маршрутизатора 
<b>М2</b> надходить пакет з адресою призначення 129.44.78.200. Модуль IP
починає послідовно переглядати всі рядки таблиці, доти поки не знайде збіги
номера мережі в адресі призначення й у рядку
таблиці. Маска з першого рядка <nobr>255.255.192.0</nobr> накладається на адресу
<nobr>129.44.78.200</nobr>, у результаті чого виходить
номер мережі <nobr>129.44.64.0</nobr>.</p>
<p>У двійковому вигляді ця операція виглядає в так:<br><nobr>10000001.00101100.01001110.11001000</nobr><br>
<nobr>11111111.11111111.11000000.00000000</nobr><br><nobr>10000001.00101100.01000000.00000000</nobr></p>
<p>Отриманий номер <nobr>129.44.64.0</nobr> порівнюється з
номером мережі в першому рядку таблиці
<nobr>129.44.0.0</nobr>. Оскільки вони не збігаються, то
відбувається перехід до наступного рядка. Тепер витягається маска із другого
рядка (у цьому випадку вона має таке ж значення, але в загальному
випадку це зовсім не обов'язково) і накладається на адресу призначення пакета 
<nobr>129.44.78.200</nobr>.
Зрозуміло, що через збіг довжини масок буде отриманий той же номер мережі <nobr>129.44.64.0</nobr>. Цей номер збігається з номером мережі в
другому рядку таблиці, а виходить, знайдений маршрут для даного пакета - він
повинен бути відправлений на порт маршрутизатора <nobr>129.44.64.7</nobr> у мережу, безпосередньо підключену
до даного маршрутизатора.</p>
<p>От ще приклад. IP-адреса
<nobr>129.44.141.15</nobr> (<nobr>10000001 00101100 10001101 00001111</nobr>), що при використанні класів
ділиться на номер мережі <nobr>129.44.0.0</nobr> і номер
вузла <nobr>0.0.141.15</nobr>, тепер, при використанні маски <nobr>255.255.192.0</nobr>, буде
інтерпретуватися як пари: <nobr>129.44.128.0</nobr> - номер
мережі, <nobr>0.0.13.15</nobr> - номер вузла.</p>
<h4><a name=41></a>Використання масок перемінної
довжини</h4>
<p>У попередньому прикладі
використання масок (див. мал. 5.15 й 5.16) всі підмережі мають
однакову довжину поля номера мережі — 18 двійкових розрядів, і, отже, для
нумерації вузлів у кожній з них виділяється по 14 розрядів. Тобто всі мережі є дуже великими й мають однаковий розмір. Однак у цьому
випадку, як й у багатьох інших, більш ефективним підійшла
б розбивка мережі на підмережі
різного розміру. Зокрема, велику кількість вузлів, цілком бажане для користувацької підмережі,
явно є надлишковим для підмережі, що зв'язує два
маршрутизатори за схемою «точка-крапка». У цьому випадку потрібні всього дві адреси
для адресації двох портів сусідніх маршрутизаторів. У попередньому ж прикладі
для цієї допоміжної мережі M1 - М2 був
використаний номер, що дозволяє адресувати 2<sup>14</sup> вузлів, що робить
таке рішення неприйнятно надлишковим. Адміністратор може більш раціонально
розподілити наявний в його розпорядженні адресний простір за допомогою масок змінної довжини.</p>
<p>На мал. 5.17 наведений приклад розподілу адресного простору, при
якому надмірність наявної множини IP-адрес може бути зведена до мінімуму.
Половина з наявних адрес (2<sup>15</sup>) була відведена для створення мережі з адресою
<nobr>129.44.0. 0</nobr> і маскою <nobr>255.255. 128.0</nobr>. Наступна порція адрес, що становить чверть усього адресного простору (2<sup>14</sup>),
була призначена для мережі <nobr>129.44.128.0</nobr> с
маскою <nobr>255.255.192.0</nobr>. Далі в просторі адрес був «вирізаний» невеликий фрагмент
для створення мережі, призначеної
для зв'язування внутрішнього маршрутизатора М2 із зовнішнім маршрутизатором Ml.</p>
<p>В IP-адресі такий виродженной мережі для поля номера вузла як мінімум повинні бути
відведені два двійкових розряди. Із чотирьох можливих комбінацій номерів
вузлів: 00, 01, 10 й 11 два номери мають
спеціальне призначення й не можуть бути привласнені вузлам, але залишившихся два 10 й
01 дозволяє адресувати порти маршрутизаторів. У нашому прикладі мережа була обрана з
деяким запасом - на 8 вузлів. Поле номера вузла в такому випадку має 3 двійкових розряди, маска в десятковому вигляді має
вид <nobr>255.255.255.248</nobr>, а номер мережі, як видно
з мал. 5.17, дорівнює в даному конкретному випадку <nobr>129.44.192.0</nobr>. Якщо ця мережа є локальною, то на ній можуть бути розташовані чотири вузли крім двох портів маршуртизаторів.</p>
<table border="0" width="100%" id="table4">
	<tr>
		<td align="center">
		<img src=images/im017.jpg alt="Мал. 5.17. Поділ адресного простору мережі класу В 129.44.0.0 на мережі різного розміру шляхом використання масок перемінної довжини" width="576" height="591"></td>
	</tr>
	<tr>
		<td align="center">Мал. 5.17. Поділ адресного простору мережі класу В 
		<nobr>129.44.0.0</nobr> на мережі різного розміру шляхом використання масок перемінної довжини</td>
	</tr>
</table>
<table border="0" cellpadding="4" cellspacing="3" width="100%" id="table5">
	<tr>
		<td valign="top">
		<img border="0" src="images/znak.gif" width="36" height="35" hspace="5"></td>
		<td>Зауважимо<i>, що глобальним зв'язкам
між маршрутизаторами типу «точка-крапка» не обов'язково давати IP-адреси, тому
що до такої мережі не можуть підключатися
ніякі інші вузли, крім двох портів маршрутизаторів. Однак найчастіше такій вирожденій мережі все-таки дають IP-адресу. Це робиться,
наприклад, для того, щоб сховати внутрішню структуру мережі
й звертатися до неї по одній адресі вхідного порту маршрутизатора, у даному
прикладі за адресою 129.44.192.1. Крім того, ця
адреса може знадобитися при тунелюванні протоколів, що немаршрутизуються, в
IP-пакети, це буде розглянуто нижче.</i></td>
	</tr>
</table>
<p>Адресний простір, що залишився, адміністратор може «нарізати» на різну
кількість мереж різного обсягу залежно від своїх потреб. З пулу, що залишився (214 - 4) адрес адміністратор
може утворити ще одну досить велику мережу із числом вузлів 213. При цьому вільними залишаться майже стільки ж адрес (2<sup>13</sup> -
4), які також можуть бути використані для створення нових мереж. Наприклад, з цього -&nbsp; «залишку»
можна утворити 31 мережу, кожна з яких
дорівнює розміру стандартної мережі класу З, і
до того ж ще кілька мереж меншого розміру. Ясно,
що розбивка може бути іншою,
але в кожному разі за допомогою масок змінного
розміру адміністратор завжди має можливість набагато раціональніше
використати всі
наявні в нього адреси.</p>
<p>На мал. 5.18 показана схема мережі, структурованої
за допомогою масок змінної довжини.</p>
<table border="0" width="100%" id="table6">
	<tr>
		<td align="center">
<img width=532 height=389
src=images/im18.jpg v:shapes=_x0000_i1028 alt="Мал. 5.18. Мережа, структурована з використанням масок змінної довжини"></td>
	</tr>
	<tr>
		<td align="center">Мал. 5.18. Мережа, структурована з використанням масок змінної
довжини</td>
	</tr>
</table>
<p>Таблиця маршрутизації <b>М2</b>, що відповідає структурі мережі, показаної
на мал. 5.18, містить записи
про чотири безпосередньо підключені мережі й запис про маршрутизатор за замовчуванням
(табл. 5.13). Процедура пошуку маршруту при
використанні масок змінної довжини нічим не
відрізняється від подібної процедури, описаної
раніше для масок однакової довжини.</p>
<table border=2 cellspacing=1 width="100%" bordercolorlight="#C0C0C0" bordercolordark="#808080" bordercolor="#C0C0C0">
	<caption style="text-align: left">&nbsp;Таблиця 5.13. Таблиця маршрутизатора
М2 у мережі з
масками змінної довжини</caption>
	<tr>
		<th valign=top nowrap bgcolor="#66CCFF">
		Номер мережі</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Маска</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Адреса наступного <br>
		маршрутизатора</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Адреса порту</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Відстань</th>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44. 0.0</td>
		<td valign=top nowrap>
		255. 255.128.0</td>
		<td valign=top nowrap>
		129.44. 0.1</td>
		<td valign=top nowrap>
		129.44. 0.1</td>
		<td valign=top nowrap>
		Підключена</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44. 128.0</td>
		<td valign=top nowrap>
		255. 255.192.0</td>
		<td valign=top nowrap>
		129.44. 128.3</td>
		<td valign=top nowrap>
		129.44. 128.3</td>
		<td valign=top nowrap>
		Підключена</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44. 192.0</td>
		<td valign=top nowrap>
		255. 255.255.248</td>
		<td valign=top nowrap>
		129.44. 192.1</td>
		<td valign=top nowrap>
		129.44. 191.1</td>
		<td valign=top nowrap>
		Підключена</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44. 224.0</td>
		<td valign=top nowrap>
		255. 255.224.0</td>
		<td valign=top nowrap>
		129.44. 224.5</td>
		<td valign=top nowrap>
		129.44. 224.5</td>
		<td valign=top nowrap>
		Підключена</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		0.0. 0.0</td>
		<td valign=top nowrap>
		0.0. 0.0</td>
		<td valign=top nowrap>
		129.44. 192.2</td>
		<td valign=top nowrap>
		129.44. 192.1</td>
		<td valign=top nowrap>
		—</td>
	</tr>
</table>
<p>Деякі особливості масок змінної довжини проявляються
при наявності так званих «перекриттів». Під перекриттям розуміється наявність декількох маршрутів до однієї
й тій же мережі або того самого вузлу. У цьому випадку адреса
мережі в пакеті,
що прийшов, може збігтися з адресами мереж, що вміщуються
відразу в декількох записах таблиці
маршрутизації.</p>
<p>Розглянемо приклад. Нехай пакет, що надійшов із
зовнішньої мережі на маршрутизатор <b>Ml</b>, має адресу
призначення 129.44. 192.5. Нижче наведений
фрагмент таблиці маршрутизації маршрутизатора <b>Ml</b>. Перший з наведених двох
записів говорить про те, що всі пакети, адреси
яких починаються на <nobr>129.44</nobr>, повинні бути передані на маршрутизатор <b>М2</b>. Цей запис виконує 
<i>агрегування </i>адрес
всіх підмереж, створених на базі однієї
мережі <nobr>129.44.0.0</nobr>. Другий рядок говорить про те, що серед всіх
можливих підмереж
мережі <nobr>129.44.0.0</nobr> є одна, <nobr>129.44.192.0,</nobr> для
якої пакети можна направляти безпосередньо, а
не через маршрутизатор <b>М2</b>.</p>
<table border=3 cellpadding=2 width="100%" bordercolorlight="#C0C0C0" bordercolordark="#808080" bordercolor="#C0C0C0">
	<tr>
		<th valign=top nowrap bgcolor="#66CCFF">
		Номер мережі</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Маска</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Адреса наступного маршрутизатора</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Адреса порту</th>
		<th valign=top nowrap bgcolor="#66CCFF">
		Відстань</th>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44. 0.0 </td>
		<td valign=top nowrap>
		255. 255.0.0 </td>
		<td valign=top nowrap>
		129.44. 192.1 </td>
		<td valign=top nowrap>
		129.44. 191.2 </td>
		<td valign=top nowrap>
		2</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		129.44. 192.0</td>
		<td valign=top nowrap>
		255. 255.255.248</td>
		<td valign=top nowrap>
		129.44. 192.2</td>
		<td valign=top nowrap>
		129.44. 192.2</td>
		<td valign=top nowrap>
		Підключена</td>
	</tr>
	</table>
<p>Якщо дотримуватися стандартного
алгоритму пошуку маршруту по таблиці, то спочатку на адресу призначення
<nobr>129.44.192.5</nobr> накладається маска з першого рядка <nobr>255.255.0.0</nobr> і виходить результат 
<nobr>129.44.0.0</nobr>, що збігається з номером мережі в
цьому рядку. Але й при накладенні на адресу <nobr>129.44.192.5</nobr> маски із другого рядка
<nobr>255.255.255.248</nobr> отриманий результат <nobr>129.44.192.0</nobr> також збігається з номером мережі в
другому рядку. У таких випадках повинно бути застосоване наступне правило:
«Якщо адреса належить декільком підмережам у базі даних маршрутів, то пакет, що
просувається, маршрутизатор використовує
найбільш специфічний маршрут, тобто вибирається адреса підмережі,
що дає більший збіг розрядів».</p>
<p>У даному прикладі буде обраний
другий маршрут, тобто пакет буде переданий у безпосередньо підключену мережу, а не піде кружним шляхом через маршрутизатор
<b>М2</b>.</p>
<p>Механізм вибору самого
специфічного маршруту є узагальненням поняття
«маршрут за замовчуванням». Оскільки в традиційному записі для маршруту за
замовчуванням <nobr>0.0.0.0</nobr> маска<nobr> 0.0.0.0 </nobr>має нульову довжину, те цей маршрут вважається самим неспецифічним
і використовується тільки при відсутності
збігів з усіма іншими записами з таблиці маршрутизації.</p>
<table border="0" cellpadding="5" cellspacing="1" width="100%" id="table7">
	<tr>
		<td valign="top">
		<img border="0" src="images/znak.gif" width="36" height="35" hspace="5"></td>
		<td><i>В IP-пакетах при використанні механізму
масок як і раніше передається тільки IP-адреса призначення, а маска мережі призначення не передається. Тому з IP-адреси
пакета, що прийшов, неможливо з'ясувати, яка частина адреси ставиться до номера мережі,
а яка - до номера вузла. Якщо маски у всіх підмережах мають один
розмір, то це не створює проблем. Якщо ж для утворення
підмережі застосовують маски змінної довжини, то маршрутизатор повинен якимсь чином дізнаватися, яким адресам мереж
які маски відповідають. Для цього використовуються
протоколи маршрутизації, що переносять між маршрутизаторами не тільки службову
інформацію про адреси мереж, але й про маски, що
відповідають цим номерам. До таких протоколів відносяться
протоколи RIPv2 й OSPF, а от, наприклад,
протокол RIP маски не розповсюджує і для
використання масок змінної довжини не підходить.</i></td>
	</tr>
</table>
<h4><a name=42></a>Технологія безкласової
міждоменної маршрутизації CIDR</h4>
<p>За останні роки у мережі Internet багато чого змінилося: різко зросло
число вузлів і мереж, підвищилася
інтенсивність трафіка, змінився характер
переданих даних. Через недосконалість протоколів маршрутизації обмін
повідомленнями про відновлення таблиць став
іноді приводити до збоїв магістральних маршрутизаторів через перевантаження при
обробці великого обсягу службової інформації.
Так, в 1994 році таблиці магістральних маршрутизаторів в Internet містили до 70&nbsp;000 маршрутів.</p>
<p>На розв'язання
цієї проблеми була спрямована, зокрема, і
технологія <i>безкласової міждоменної маршрутизації (Classless Inter-Domain
Routing, CIDR), </i>уперше про яку було офіційно оголошено в 1993 році, коли
були опубліковані RFC 1517, RFC 1518, RFC 1519 й RFC 1520.</p>
<p>Суть технології CIDR полягає в наступному.
Кожному постачальникові послуг Internet
повинен призначатися безперервний діапазон у просторі IP-адрес. При такому
підході адреси всіх мереж кожного постачальника послуг мають загальну старшу частину — 
<i>префікс, </i>тому
маршрутизація на магістралях Internet може здійснюватися на основі префіксів, а
не повних адрес мереж.
Агрегування адрес дозволить зменшити обсяг
таблиць у маршрутизаторах всіх рівнів, а отже, прискорити роботу
маршрутизаторів і підвищити пропускну здатність
Internet.</p>
<table border="0" width="100%" id="table8">
	<tr>
		<td align="center">
<img width=422 height=488 src=images/im019.jpg alt="Мал. 5.19. Технології CIDR"></td>
	</tr>
	<tr>
		<td align="center">Мал. 5.19. Технології CIDR</td>
	</tr>
</table>
<p>Розподіл IP-адреси на номер мережі й номер вузла в технології CIDR відбувається
не на основі декількох старших біт, що визначають клас мережі (А, В або С),
а на основі маски змінної довжини, що призначається постачальником послуг. На мал. 5.19
показаний приклад деякого простору IP-адрес, що є в розпорядженні гіпотетичного
постачальника послуг. Всі адреси мають загальну
частину в k старших розрядах - префікс. Що залишилися
N розрядів використаються
для доповнення незмінного префікса змінною
частиною адреси. Діапазон наявних адрес у такому випадку становить 2 у ступені
N. Коли споживач послуг звертається до постачальника послуг із проханням про
виділення йому деякої кількості адрес, то в наявному пулі адрес «вирізає»
безперервну множину S1, S2, S3 або S4
відповідного розміриу. Причому границі цієї області вибираються такими, щоб для нумерації
необхідного числа вузлів вистачило деякого числа молодших розрядів, а значення всіх що залишилися
(старших) розрядів були однаковими у всіх
адрес даного діапазону. Таким умовам можуть задовольняти тільки області, розмір яких кратний ступеня двійки. А границі
виділюваної ділянки повинні бути кратні
необхідному розміру.</p>
<p>Розглянемо приклад. Нехай постачальник послуг
Internet має у своєму розпорядженні пул адрес у діапазоні
<nobr>193.20.0.0</nobr>-<nobr>193.23.255.255</nobr> (<nobr>1100 0001.0001 0100.0000 0000.0000 0000</nobr>-<nobr>1100
0001.0001 0111.11111111.1111 1111</nobr>) із загальним
префіксом <nobr>193.20</nobr> (<nobr>1100 0001.0001 01</nobr>) і маскою, що відповідає цьому префіксу 
<nobr>255.252.0.0.</nobr></p>
<p>Якщо абонентові
цього постачальника послуг потрібно зовсім небагато
адрес, наприклад 13, то постачальник міг би запропонувати йому різні варіанти: мережа 
<nobr>193.20.30.0</nobr>, мережа
<nobr>193.20.30.16</nobr> або мережа <nobr>193.21.204.48</nobr>, усі з тим самим
значенням маски <nobr>255.255.255.240</nobr>. У всіх випадках у розпорядженні абонента для
нумерації вузлів є 4 молодших біти.</p>
<p>Розглянемо інший варіант, коли до постачальника
послуг звернувся великий замовник, сам, що можливо збирається робити послуги з доступу в Internet. Йому потрібен
блок адрес в 4000 вузлів. У цьому випадку постачальник послуг міг би
запропонувати йому, наприклад, діапазон адрес <nobr>193.22.160.0</nobr> - <nobr>193.22.175.255</nobr> з маскою 
<nobr>255.255.240.0</nobr>. Агрегований
номер мережі (префікс) у цьому випадку буде
дорівнювати 193.22.160.0.</p>
<p>Адміністратор маршрутизатора <b>М2</b> (мал. 5.20) помістить у таблицю
маршрутизації тільки по одному запису на
кожного клієнта, якому був виділений пул адрес, незалежно від кількості підмереж, організує
клієнт. Якщо клієнт, що одержав мережу <nobr>193.22.160.0</nobr>, через якийсь час розділить її
адресний простір в 4096 адрес на 8 підмереж, то
в маршрутизаторі <b>М2</b> первісна інформація про виділену йому мережу не зміниться.</p>
<table border="0" width="100%" id="table9">
	<tr>
		<td align="center">
<img width=481 height=380 src=images/im020.jpg alt="Мал. 5.20. Виграш у кількості записів у маршрутизаторі при використанні технології CIDR"></td>
	</tr>
	<tr>
		<td align="center">Мал. 5.20. Виграш у кількості записів у маршрутизаторі при
використанні технології CIDR</td>
	</tr>
</table>
<p>Для постачальника послуг
верхнього рівня, що підтримує клієнтів через маршрутизатор <b>M1</b>, зусилля постачальника послуг нижнього рівня по поділі його адресного простору також не будуть
помітні. Запис <nobr>193.20.0.0</nobr> з маскою <nobr>255.252.0.0</nobr>
повністю описує мережі
постачальника послуг нижнього рівня в маршрутизаторі Ml.</p>
<p>Отже, впровадження технології
CIDR дозволяє вирішити два основні завдання.</p>
<ul type=disc>
	<li>Більш ощадливо витрачати адресний простір. Дійсно, одержуючи у своє розпорядження адресу мережі, наприклад, класу С, деякі організації не використають весь можливий діапазон адрес просто тому, що в їхній мережі є набагато менше 255 вузлів. Технологія CIDR відмовляється від традиційної концепції поділу адрес протоколу IP на класи, що дозволяє одержувати в користування стільки адрес, скільки реально необхідно. Завдяки технології CIDR постачальники послуг одержують можливість «нарізати» блоки з виділеного їм адресного простору в точній відповідності з вимогами кожного клієнта, при цьому у клієнта залишається простір для маневру на випадок його майбутнього росту.</li>
	<li>Зменшення числа записів у таблицях маршрутизаторів за рахунок об'єднання маршрутів - один запис у таблиці маршрутизації може представляти велику кількість мереж. Дійсно, для всіх мереж, номера яких починаються з однакової послідовності цифр, у таблиці маршрутизації може бути передбачений один запис (див. мал. 5.20). Так, маршрутизатор 
	<b>М2</b> встановлений в організації, що використовує техніку CIDR для виділення адрес своїм клієнтам, повинен підтримувати у своїй таблиці маршрутизації всі 8 записів про мережі клієнтів. А маршрутизатору 
	<b>Ml</b> досить мати один запис про всі ці мережі, на підставі якого він передає пакети із префіксом 
	<nobr>193.20</nobr> маршрутизатору 
	<b>М2</b>, що їх і розподіляє по потрібних портах.</li>
</ul>
<p>Якщо всі постачальники послуг
Internet будуть дотримуватися стратегії CIDR,
то особливо помітний виграш буде досягатися в магістральних маршрутизаторах.
Технологія CIDR уже успішно використовується в
поточній версії IPv4 і підтримується такими протоколами маршрутизації, як OSPF,
RIP-2, BGP4. Передбачається, що ці ж протоколи
будуть працювати й з новою версією протоколу
IPv6. Слід зазначити, що зараз технологія CIDR підтримується магістральними
маршрутизаторами Internet, а не звичайними хостами
в локальних мережах. Використання CIDR у мережах IPv4 у загальному
випадку вимагає перенумерації мереж. Оскільки ця процедура зв'язана з певними 
тимчасовими й матеріальними витратами, для її проведення користувачів потрібно 
яким-небудь чином стимулювати. Як такі стимули розглядається, наприклад, 
введення оплати за рядок у таблиці маршрутизації або ж за кількість вузлів у 
мережі. При використанні класів мереж абонент часто не повністю займає весь 
припустимий діапазон адрес вузлів - 254 адреси для мережі класу С або <nobr>65&nbsp;534</nobr>
адреси для мережі класу В. Частина адрес вузлів звичайно пропадає. Вимога оплати кожної адреси вузла допоможе користувачам зважитися на перенумерацію, для того
щоб отримати рівно стільки адрес, скільки йому потрібно.</p>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="table1">
  <tr>
    <td width="100%" align="left" colspan="3"><hr color="#2D4C54" size="4"></td>
  </tr>
  <tr>
    <td width="33%" align="left"><a href="020.htm">Попередня</a></td>
    <td width="33%" align="center"><a href="001.htm">Перша</a></td>
    <td width="34%" align="right"><a href="022.htm">Наступна</a></td>
  </tr>
</table></body>
</html>
