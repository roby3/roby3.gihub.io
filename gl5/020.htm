<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta http-equiv="Content-Language" content="uk">
<link rel=Edit-Time-Data href=../tmp/5.3.4_u.files/editdata.mso>
<title>5.3.4. Маршрутизація без використання масок</title>
</head>
<body lang=Ua>
<h3>5.3.4.
Маршрутизація без використання масок</h3>
<p>Розглянемо на прикладі IP-мережі (мал. 5.14)
алгоритм роботи засобів мережного рівня по просуванню
пакета в складеній мережі.
При цьому будемо вважати, що всі вузли мережі, яка розглядається
в прикладі, мають адреси, засновані на класах, без використання масок. Особлива
увагу буде приділено
взаємодії протоколу IP із протоколами дозволу
адрес ARP й DNS.</p>
<table border="0" width="100%" id="table1">
	<tr>
		<td align="center">
<img width=500 height=534 src=images/im14.jpg  longdesc="Мал. 5.14. Приклад взаємодії комп'ютерів через мережу" alt="Мал. 5.14. Приклад взаємодії комп'ютерів через мережу"></td>
	</tr>
	<tr>
		<td align="center">Мал. 5.14. Приклад взаємодії комп'ютерів через мережу</td>
	</tr>
</table>
<table border="0" cellpadding="4" cellspacing="1" width="100%" id="table2">
	<tr>
		<th width="30" valign="top">1.</th>
		<td>Отже, нехай користувач комп'ютера cit.dol.ru, що перебуває в мережі Ethernet і має IP-адресу 194.87.23.17 (адреса класу З), звертається за протоколом FTP до комп'ютера sl.msk.su, що належить іншій мережі Ethernet і має IP-адресу 142.06.13.14 (адреса класу В): ftp sl.msk.su<p>Модуль
FTP упаковує своє повідомлення в сегмент транспортного протоколу TCP, що у свою
чергу поміщає свій сегмент у пакет протоколу IP. У заголовку IP-пакета повинна
бути зазначена IP-адреса вузла призначення.
Тому що користувач комп'ютера cit.dol.ru використовує
символьне ім'я комп'ютера sl.msk.su, те стек TCP/IP повинен визначити IP-адресу
вузла призначення самостійно.</p>
<p>При
конфігуруванні стека TCP/IP у комп'ютері cit.dol.ru була задана його власна
IP-адреса, IP-адреса маршрутизатора за замовчуванням й IP-адреса
DNS- сервера. Модуль IP може зробити запит до сервера DNS, але звичайно
спочатку проглядається локальна таблиця відповідності символьних імен й
IP-адрес. Така таблиця зберігається найчастіше у вигляді текстового файла
простої структури - кожен його рядок містить запис про одне символьне ім'я і його
IP-адресу. В ОС Unix такий файл традиційно має
ім'я hosts і перебуває в каталозі /etc.</p>
		</td>
	</tr>
	<tr>
		<th width="30" valign="top">2.</th>
		<td>Будемо вважати, що комп'ютер cit.dol.ru має файл hosts, а в ньому є рядок 142.06.13.14 sl.msk.su<p>Таким
чином, дозвіл імені
виконується локально, і протокол IP може тепер формувати IP-пакети з адресою призначення 142.06.13.14 для взаємодії з комп'ютером sl.msk.su.</p>
		</td>
	</tr>
	<tr>
		<th width="30" valign="top">3.</th>
		<td>Модуль IP комп'ютера cit.dol.ru перевіряє, чи потрібно маршрутизувати пакети з адресою <nobr>142.06.13.14.</nobr> Тому що адреса мережі призначення 
		<nobr>(142.06.0.0)</nobr> не збігається з адресою <nobr>(194.87.23.0)</nobr> мережі, якій належить комп'ютер-відправник, то маршрутизація необхідна.</td>
	</tr>
	<tr>
		<th width="30" valign="top">4.</th>
		<td>Комп'ютер cit.dol.ru починає формувати кадр Ethernet для відправлення IP-пакета маршрутизатору за замовчуванням, IP-адреса якого відома - 
		<nobr>194.87.23.1</nobr>, але невідома Мас-адреса, необхідна для переміщення кадру в локальній мережі. Для визначення Мас-адреси маршрутизатора протокол IP звертається до протоколу ARP, що переглядає ARP-таблицю. Якщо останнім часом комп'ютер cit.dol.ru виконував які-небудь міжмережні обміни, то швидше за все шуканий запис, що містить відповідність між IP- і Мас-адресами маршрутизатора за замовчуванням уже перебуває в кеш-таблиці протоколу ARP. Нехай у цьому випадку потрібний запис був знайдений саме в кеш-таблице<br>
	<br><nobr>194.87.23.1 008048ЕВ7Е60</nobr><p>Позначимо
знайдену МАС-адресу 008048ЕВ7Е60 відповідно до номера маршрутизатора і його
порту через МАС<sub>11</sub>.</p>
		</td>
	</tr>
	<tr>
		<th width="30" valign="top">5.</th>
		<td>В результаті комп'ютер cit.dol.ru відправляє по локальній мережі пакет, упакований у кадр Ethernet, що має наступні поля:
		<br>
		<img width=530 height=137 src=images/p1.jpg></td>
	</tr>
	<tr>
		<th width="30" valign="top">6.</th>
		<td>Кадр приймається <b>портом 1маршрутизатора 1</b> відповідно до протоколу Ethernet, тому що Мас-вузол цього порту розпізнає свою адресу. Протокол Ethernet витягає із цього кадру IP-пакет і передає його програмному забезпеченню маршрутизатора, що реалізує протокол IP. Протокол IP витягає з пакета адресу призначення 
		<nobr>142.06.13.14</nobr> і переглядає запису своїй таблиці маршрутизації. Нехай маршрутизатор 1 має у своїй таблиці маршрутизації запис 
	<br><nobr>142.06.0.0 135.12.0.11 2</nobr>, яка говорить про те, що пакети для мережі 
		<nobr>142.06.0.0</nobr> потрібно передавати маршрутизатору <nobr>135.12.0.11</nobr>, що перебуває в мережі,
підключеній до <b>порту 2маршрутизатори 1</b>.</td>
	</tr>
	<tr>
		<th width="30" valign="top">7.</th>
		<td><b>Маршрутизатор 1</b> переглядає параметри <b>порту 2</b> і знаходить, що до нього підключена мережа FDDI. Тому що мережа FDDI має значення MTU більше, ніж мережа Ethernet, тому фрагментація IP-пакета не потрібна. Тому 
	<b>маршрутизатор 1</b> формує кадр формату FDDI. На цьому етапі модуль IP повинен визначити Мас-адресу наступного маршрутизатора по відомій IP-адресі 135.12.0.11. Для цього він звертається до протоколу ARP. Припустимо, що потрібного запису в кеш-таблиці не виявилося, тоді в мережу FDDI відправляється широкомовний ARP-запит, що містить поряд з іншої наступну інформацію.<br>
		<img width=501 height=187 src=images/p2.jpg><br>
		<b>Порт 1 маршрутизатора 2</b> розпізнає свою IP-адресу
й посилає ARP-відповідь за адресою вузла, що запросив:<br>
		<img width=507 height=188 src=images/p3.jpg ><br>
		Тепер, знаючи Мас-адресу наступного маршрутизатора <nobr>00E0F77F51A0</nobr>, <b>маршрутизатор 1</b> відсилає кадр FDDI у
напрямку до <b>маршрутизатора 2</b>.
Помітимо, що в поле IP-адреси призначення
ніяких змін не відбулося.<br>
		<img src=images/p4.jpg width="478" height="230"></td>
	</tr>
	<tr>
		<th width="30" valign="top">8.</th>
		<td>Аналогічно діє модуль IP на <b>маршрутизаторі 2</b>. Одержавши кадр FDDI, він відкидає його заголовок, а із заголовка IP витягає IP-адресу мережі призначення й переглядає свою таблицю маршрутизації. Там він може знайти запис про конкретну мережу призначення:<br>
	<br><nobr>142.06.0.0 203.21.4.12 2</nobr><br><br>або при відсутності такого запису буде використаний запис про маршрутизатор за замовчуванням:<br>
		<nobr>default 203.21.4.12 2</nobr>,<br>Визначивши IP-адресу наступного маршрутизатора 
		<nobr>203.21.4.12</nobr>, модуль IP формує кадр Ethernet для передачі пакета 
	<b>маршрутизатору 3</b> по мережі Ethernet.
<p>За
допомогою протоколу ARP він знаходить Мас-адресу цього маршрутизатора й поміщає його в заголовок кадру. IP-адреса
вузла призначення, природно, залишається незмінною.<br>
<img width=490 height=158 src=images/p5.jpg></p>
		</td>
	</tr>
	<tr>
		<th width="30" valign="top">9.</th>
		<td>Нарешті, після того як пакет надійшов у маршрутизатора мережі призначення - 
	<b>маршрутизатор 3</b>, - з'являється можливість передачі цього пакета комп'ютеру призначення. 
	<b>Маршрутизатор 3</b> визначає, що пакет потрібно передати в мережу <nobr>142.06.0.0</nobr>, що безпосередньо підключена до його першого порту. Тому він посилає ARP-запит по мережі Ethernet з IP-адресою комп'ютера s1.msk.su. ARP-відповідь містить Мас-адресу кінцевого вузла, що модуль IP передає канальному протоколу для формування кадру Ethernet:
		<br>
		<img width=498 height=158 src=images/p6.jpg></td>
	</tr>
	<tr>
		<th width="30" valign="top">10.</th>
		<td>Мережевий адаптер комп'ютера sl.msk.su захоплює кадр Ethernet, виявляє збіг Мас-адрес, що міститься в заголовку, зі своєю власною адресою й направляє його модулю IP. Після аналізу полів IP-заголовка з пакета витягаються дані, які у свою чергу містять повідомлення вище лежачого протоколу. Оскільки в даному прикладі розглядається обмін даними за протоколом FTP, що використовується як транспортний протокол TCP, то в полі даних IP-пакета перебуває TCP-сегмент. Визначивши з TCP-заголовка номер порту, модуль IP переправляє сегмент у відповідну чергу, з якої даний сегмент потрапить програмному модулю FTP-сервера.</td>
	</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="table1">
  <tr>
    <td width="100%" align="left" colspan="3"><hr color="#2D4C54" size="4"></td>
  </tr>
  <tr>
    <td width="33%" align="left"><a href="019.htm">Попередня</a></td>
    <td width="33%" align="center"><a href="001.htm">Перша</a></td>
    <td width="34%" align="right"><a href="021.htm">Наступна</a></td>
  </tr>
</table></body>
</html>
