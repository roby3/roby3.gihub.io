<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta http-equiv="Content-Language" content="uk">
<link rel=Edit-Time-Data href=../tmp/vol5_3_2_u.files/editdata.mso>
<title>5.3.2. Структура IP-пакета</title>
</head>
<body lang=Ua>
<h3>5.3.2. Структура IP-пакета</h3>
<p>IP-пакет складається із заголовка
й поля даних. Заголовок, що, як правило, має довжину 20 байт, має наступну
структуру (мал. 5.12).</p>
<table border="0" width="100%" id="table1">
	<tr>
		<td align="center">
		<img src="images/im012.jpg" width="515" height="336" alt="Мал. 5.12. Структура заголовка IP-пакета"></td>
	</tr>
	<tr>
		<td align="center">Мал. 5.12. Структура заголовка IP-пакета</td>
	</tr>
</table>
<p>Поле <i>Номер версії (Version)</i>, що займає 4
біти, вказує версію протоколу IP. Зараз
повсюдно використовується версія 4 (IPv4), і готується перехід на версію 6 (IPv6).</p>
<p>Поле <i>Довжина заголовка (IHL) </i>IP-пакета
займає 4 біта і вказує значення довжини
заголовка, вимірюване в 32-бітових словах.
Звичайно заголовок має довжину в 20 байт (п'ять
32-бітових слів), але при збільшенні обсягу
службової інформації ця довжина може бути збільшена за рахунок використання додаткових байт у полі
<i>Опції (IP Options). </i></p>
<p>Поле <i>Тип сервісу (Type of Service)
</i>займає один
байт і задає пріоритетність пакета й вид
критерію вибору маршруту. Перші три біти цього поля утворять підполе <i>пріоритету 
</i>пакета <i>(Precedence).
</i>Пріоритет може мати значення від найнижчого — <b>0</b> (нормальний пакет) до найвищого — 
<b>7</b> (пакет керуючої інформації). Маршрутизатори й комп'ютери можуть
брати до уваги пріоритет пакета й обробляти більш
важливі пакети в першу чергу. Поле <i>Тип сервісу </i>містить
також три біти, що визначають
критерій вибору маршруту. Реально вибір здійснюється між трьома альтернативами:
малою затримкою, високою вірогідністю й високою пропускною здатністю. Встановлений
біт <b>D</b> (delay)
говорить про те, що маршрут повинен вибиратися
для мінімізації затримки доставки даного пакета, біт <b>Т</b> — для максимізації пропускної здатності,
а біт <b>R</b> — для максимізації
надійності доставки. У багатьох мережах
поліпшення одного із цих параметрів пов'язане
з погіршенням іншого, крім того, обробка кожного з них вимагає додаткових
обчислювальних витрат. Тому рідко, коли має сенс установлювати
одночасно хоча б два із цих трьох критеріїв
вибору маршруту. Зарезервовані біти мають нульове значення.</p>
<p>Поле <i>Загальна
довжина (Total Length) </i>займає 2 байти й означає загальну
довжину пакета з урахуванням заголовка й поля даних. Максимальна довжина пакета
обмежена розрядністю поля, що визначає цю величину, і становить
65&nbsp;535&nbsp;байт, однак у більшості хост-комп'ютерів і мереж
настільки великі пакети не використовуються. При передачі по мережах різного типу довжина пакета вибирається з
урахуванням максимальної довжини пакета протоколу нижнього рівня, що несе
IP-пакети. Якщо це кадри Ethernet, то вибираються
пакети з максимальною довжиною в 1&nbsp;500&nbsp;байт,
що вміщаються в поле даних кадру Ethernet. У стандарті передбачається, що всі хости
повинні бути готові приймати пакети аж до 576&nbsp;байт довжиною ( чи приходять
вони цілком або по фрагментах). Хостам
рекомендується відправляти пакети розміром більш ніж 576&nbsp;байт, тільки якщо
вони впевнені, що приймаючий хост або проміжна мережа готові обслуговувати пакети такого розміру.</p>
<p>Поле <i>Ідентифікатор пакета (Identification) </i>займає
2&nbsp;байти й використовується для
розпізнавання пакетів, що утворилися шляхом фрагментації вихідного пакета. Всі
фрагменти повинні мати однакове значення цього поля.</p>
<p>Поле <i>Прапори (Flags) </i>займає 3&nbsp;біти
й містить ознаки, пов'язані із фрагментацією. Встановлений біт <b>DF</b> (Do not Fragment) забороняє маршрутизатору
фрагментувати даний
пакет, а встановлений біт <b>MF</b> (More Fragments) говорить про те, що даний пакет є проміжним (не останнім)
фрагментом. Біт, що залишився, зарезервований.</p>
<p>Поле <i>Зсув фрагмента (Fragment Offset) </i>займає 13&nbsp;біт і задає зсув у байтах поля даних цього пакета від початку загального поля даних вихідного пакета, підданого фрагментації. Використовується
при зборці/розбиранні
фрагментів пакетів при передачах їх між мережами
з різними величинами
MTU. Зсув повинен бути кратним 8&nbsp;байт.</p>
<p>Поле <i>Час життя (Time to Live) </i>займає один байт й
означає граничний строк, протягом якого пакет може переміщатися по мережі. Час життя даного пакета виміряється в
секундах і задається джерелом передачі. На маршрутизаторах й в інших вузлах мережі після закінчення кожної секунди з поточного
часу життя віднімається одиниця; одиниця віднімається й у тому випадку, коли час затримки
менше секунди. Оскільки сучасні маршрутизатори рідко обробляють пакет довше,
ніж за одну секунду, то час життя можна вважати
рівним максимальному числу вузлів, які дозволено пройти
даному пакету до того, як він досягне місця
призначення. Якщо параметр часу життя стане нульовим до того, як пакет досягне одержувача, цей
пакет буде знищений. Час життя можна розглядати як годинний
механізм самознищення. Значення цього поля змінюється при обробці заголовка IP-пакета.</p>
<p>Ідентифікатор
<i>Протокол верхнього рівня (Protocol) </i>займає один байт і
вказує, якому протоколу верхнього рівня
належить інформація, розміщена в полі даних
пакета (наприклад, це можуть бути сегменти протоколу TCP, дейтаграми UDP, пакети ICMP або OSPF). Значення
ідентифікаторів для різних протоколів приводяться
в документі RFC «Assigned Numbers».</p>
<p><i>Контрольна сума (Header Checksum) </i>займає 2&nbsp;байти й розраховується тільки по заголовку. Оскільки деякі
поля заголовка міняють своє значення в процесі
передачі пакета по мережі (наприклад, час
життя), контрольна сума перевіряється й повторно розраховується при кожній
обробці IP-заголовка. Контрольна сума – 16&nbsp;біт - підраховується як
доповнення до суми всіх 16-бітових слів заголовка. При обчисленні контрольної суми
значення самого поля «контрольна сума» встановлюється
в нуль. Якщо контрольна сума невірна, то пакет
буде відкинутий, як тільки помилка буде виявлена.</p>
<p>Поля <i>IP-адреса
джерела (Source IP Address)
</i>і <i>IP-адреса призначення (Destination IP Address) </i>мають
однакову довжину — 32&nbsp;біта — і однакову структуру.</p>
<p>Поле <i>Опції (IP Options) </i>є
необов'язковим і використається звичайно
тільки при налагодженні мережі. Механізм опцій
надає функції керування,
які необхідні або просто корисні при певних
ситуаціях, однак він не потрібний при звичайних комунікаціях. Це поле
складається з декількох підполей, кожне з яких може бути одним з восьми
визначених типів. У цих підполях можна вказувати точний маршрут
проходження маршрутизаторів, реєструвати прохідні
пакетом маршрутизатори, поміщати дані системи безпеки, а також тимчасові оцінки.
Тому що число підполей
може бути довільним, то наприкінці поля <i>Опції
</i>повинне бути додане трохи байт для вирівнювання заголовка пакета по
32-бітній границі.</p>
<p>Поле
<i>Вирівнювання (Padding) </i>використовується для того, щоб переконатися в тому, що IP-заголовок закінчується на 32-бітній границі. Вирівнювання здійснюється нулями.</p>
<p>Нижче наведена
роздруківка значень полів заголовка одного з реальних IP-пакетів, захоплених у мережі
Ethernet засобами аналізатора протоколів Microsoft Network Monitor.</p>
<p>IP: Version
= 4 (0x4) <br>IP: Header Length = 20
(0x14) <br>IP: Service Type = 0 (0x0) <br>IP: Precedence = Routine <br>IP: ...0.... = Normal Delay<br>IP: ....0... = Normal Throughput<br>IP: .....0.. = Normal Reliability<br>IP: Total Length = 54
(0x36)<br>IP: Identification = 31746 (Ox7C02)<br>IP: Flags Summary = 2 (0x2)<br>IP: .......0 = Last fragment
in datagram<br>IP: ......1. = Cannot fragment
datagram<br>IP: Fragment Offset = 0
(0x0) bytes<br>IP: Time to Live = 128 (0x80)<br>IP: Protocol = TCP - Transmission
Control<br>IP: Checksum = OxEB86<br>IP: Source Address =
194.85.135.75<br>IP: Destination Address =
194.85.135.66<br>IP: Data: Number of data bytes remaining = 34 (0x0022)</p>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="table1">
  <tr>
    <td width="100%" align="left" colspan="3"><hr color="#2D4C54" size="4"></td>
  </tr>
  <tr>
    <td width="33%" align="left"><a href="017.htm">Попередня</a></td>
    <td width="33%" align="center"><a href="001.htm">Перша</a></td>
    <td width="34%" align="right"><a href="019.htm">Наступна</a></td>
  </tr>
</table></body>
</html>
