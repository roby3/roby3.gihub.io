<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta http-equiv="Content-Language" content="uk">
<title>5.2.7. Відображення IP-адрес на локальні адреси</title>
</head>
<body lang=Ua>
<h3>5.2.7.
Відображення IP-адрес на локальні адреси</h3>
<p>Однією з головних задач,
яка ставилася при створенні протоколу IP, було
забезпечення спільної погодженої роботи в мережі,
що складається з підмережей, у загальному
випадку мережеві технології, що використовують різні. Безпосередньо з розв'язанням цієї
задачі зв'язаний
рівень міжмережевих
інтерфейсів стека TCP/IP. На цьому рівні визначаються
вже розглянуті вище специфікації упаковки (інкапсуляції) IP-пакетів у кадри локальних
технологій. Крім цього, рівень міжмережевих
інтерфейсів повинен займатися також украй
важливою задачею відображення IP-адрес у
локальні адреси.</p>
<p>Для визначення локальної адреси
по IP-адресі використовується <b><i>протокол дозволу
адреси</i></b> (<b><i>Address</i></b><b><i> Resolution Protocol, ARP</i></b>). Протокол ARP працює різним образом залежно від того,
який протокол канального рівня працює в даній мережі
- протокол локальної мережі (Ethernet, Token Ring, FDDI) з можливістю
широкомовного доступу одночасно до всіх вузлів мережі
або ж протокол глобальної мережі (Х.25, frame relay), як правило не
підтримуючий широкомовний доступ. Існує також протокол, що вирішує зворотню задачу - знаходження IP-адреси по відомій локальній адресі.
Він називається реверсивним ARP (Reverse Address Resolution Protocol, RARP) і використовується при старті бездискових
станцій, що не знають у початковий момент своєї IP-адреси, але знають адресу
свого мережевого адаптера.</p>
<p>Необхідність у звертанні до
протоколу ARP виникає щораз, коли модуль IP передає пакет на рівень мережевих інтерфейсів, наприклад драйверу Ethernet. IP-адреса вузла призначення відома модулю IP. Потрібно на його основі знайти Мас-адресу вузла призначення.</p>
<p>Робота протоколу ARP починається з перегляду так називаної <i>ARP-таблиці </i>(табл.
5.5). Кожен рядок таблиці встановлює
відповідність між IP-адресою й Мас-адресою. Для
кожної мережі, підключеної
до мережевого адаптера комп'ютера або до порту
маршрутизатора, будується окрема ARP-таблиця.</p>
<table border=1 cellspacing=0 cellpadding=2 width="100%">
	<caption style="text-align: left">Таблиця 5.5.Приклад ARP-таблиці</caption>
	<tr>
		<th valign=top nowrap>
		IP-адреса</th>
		<th valign=top nowrap>
		МАС-адреса</th>
		<th valign=top nowrap>
		Тип запису</th>
	</tr>
	<tr>
		<td valign=top nowrap>
		194.85.135.75 </td>
		<td valign=top nowrap>
		008048ЕВ7Е60 </td>
		<td valign=top nowrap>
		Динамічний</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		194.85.135.70 </td>
		<td valign=top nowrap>
		08005А21А722 </td>
		<td valign=top nowrap>
		Динамічний </td>
	</tr>
	<tr>
		<td valign=top nowrap>
		194.85.60.21</td>
		<td valign=top nowrap>
		008048ЕВ7567 </td>
		<td valign=top nowrap>
		Статичний </td>
	</tr>
</table>
<p>Поле «Тип запису» може містити одне із
двох значень - «динамічний» або «статичний». Статичні записи створюються вручну за
допомогою утиліти <b>arp</b> і не мають терміну старіння, точніше,
вони існують доти, поки комп'ютер або маршрутизатор не будуть виключені.
Динамічні ж записи створюються модулем протоколу ARP, що використовує широкомовні можливості локальних мережевих технологій. Динамічні записи повинні
періодично обновлятися. Якщо запис не обновлявся протягом певного часу (порядку декількох
хвилин), то він виключається з таблиці. Таким чином, в ARP-таблиці містяться записи не про всі вузли мережі, а тільки про ті,
які беруть активну участь у мережевих
операціях. Оскільки такий спосіб зберігання
інформації називають кешуванням,
ARP-таблиці іноді називають ARP-кеш.</p>
<p>У глобальних мережах адміністратору
мережі найчастіше доводиться
вручну формувати ARP-таблиці, у яких він задає, наприклад, відповідність
IP-адреси адресі вузла мережі Х.25, що має для
протоколу IP смисл локальної адреси. Останнім
часом намітилася тенденція автоматизації роботи протоколу ARP й у глобальних мережах. Для цієї мети
серед всіх маршрутизаторів, підключених до
якої-небудь глобальної мережі, виділяється
спеціальний маршрутизатор, що веде ARP-таблицю
для всіх інших вузлів і маршрутизаторів цієї мережі.
При такому централізованому підході для всіх вузлів і маршрутизаторів вручну
потрібно задати тільки IP-адресу й локальну адресу виділеного маршрутизатора.
Потім кожен вузол і маршрутизатор реєструє
свої адреси у виділеному маршрутизаторі, а при необхідності встановлення
відповідності між IP-адресою й локальною адресою вузол звертається до
виділеного маршрутизатора із запитом й автоматично отримує
відповідь без участі адміністратора. Працюючий у такий спосіб маршрутизатор
називають ARP-сервером.</p>
<p>Отже, після того як модуль IP
звернувся до модуля ARP із запитом на дозвіл
адреси, відбувається пошук в ARP-таблиці зазначеної
в запиті IP-адреси. Якщо така адреса в ARP-таблиці
відсутня, то вихідний IP-пакет, для якого
потрібно було визначити локальну адресу,
ставиться в чергу. Далі протокол ARP формує свій запит (ARP-запит), вкладає його в кадр протоколу канального рівня й розсилає
запит широкомовно.</p>
<p>Всі вузли локальної мережі отримують
ARP-запит і порівнюють зазначену там IP-адресу
із власною. У випадку їхнього збігу вузол формує ARP-відповідь, у якій вказує свою IP-адресу й свою локальну адресу, а
потім відправляє його вже направленно,
тому що в ARP-запиті відправник указує свою
локальну адресу. ARP-запити й відповіді використовують
той самий формат пакета. У табл. 5.6 наведені
значення полів прикладу
ARP-запиту для передачі по мережі Ethernet.</p>
<table border=1 cellspacing=0 cellpadding=2>
	<caption style="text-align: left">&nbsp;Таблиця
5.6. Приклад ARP-запиту</caption>
	<tr>
		<th nowrap align="left">
		Тип мережі</th>
		<td valign=top>
		1 (0x1)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Тип протоколу</th>
		<td valign=top>
		2048 (0x800)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Довжина локальної адреси</th>
		<td valign=top>
		6(0x6)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Довжина мережевої адреси</th>
		<td valign=top>
		4 (0x4)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Опція</th>
		<td valign=top>
		1 (0x1)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Локальна адреса відправника</th>
		<td valign=top>
		008048ЕВ7Е60</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Мережева адреса відправника</th>
		<td valign=top>
		194.85. 135.75</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Локальна (шукана) адреса одержувача</th>
		<td valign=top>
		000000000000</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Мережева адреса одержувача</th>
		<td valign=top>
		194.85. 135.65</td>
	</tr>
</table>
<p>У полі
«тип мережі» для мереж
Ethernet указується
значення 1.</p>
<p>Поле «тип протоколу» дозволяє використовувати протокол ARP не тільки для протоколу
IP, але й для інших мережевих протоколів. Для
IP значення цього поля дорівнює 0S00<sub>16</sub>.</p>
<p>Довжина локальної адреси для
протоколу Ethernet дорівнює 6 байт, а довжина
IP-адреси - 4 байт. У полі операції для
ARP-запитів указується значення 1, якщо це
запит, і 2, якщо це відповідь.</p>
<p>Із цього запиту видно, що в мережі Ethernet вузол з IP-адресою <nobr>194.85.135.75</nobr> намагається визначити, яку Мас-адресу
має інший вузол тієї ж мережі, мережева адреса якого <nobr>194.85.135.65.</nobr> Поле шуканої локальної
адреси заповнено нулями.</p>
<p>Відповідь надсилає вузол, що
пізнав свою IP-адресу. Якщо в мережі немає
машини із шуканою IP-адресою, то ARP-відповіді не буде. Протокол IP знищує
IP-пакети, що направляються по цій адресі.
(Помітимо, що протоколи верхнього рівня не можуть відрізнити випадок ушкодження мережі Ethernet від випадку відсутності машини із шуканою
IP-адресою.) У табл. 5.7 поміщені значення полів
ARP-відповіді, що міг би надійти на наведений
вище приклад ARP-запиту.</p>
<table border=1 cellspacing=1 cellpadding=2>
	<caption style="text-align: left">&nbsp;Таблиця 5.7. Приклад ARP-відповіді</caption>
	<tr>
		<th nowrap align="left">
		Тип мережі</th>
		<td valign=top nowrap>
		1 (0x1)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Тип протоколу</th>
		<td valign=top nowrap>
		2048 (0x800)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Довжина локальної адреси</th>
		<td valign=top nowrap>
		6 (0x6)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Довжина мережевої адреси</th>
		<td valign=top nowrap>
		4 (0x4)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Опція</th>
		<td valign=top nowrap>
		2 (0x2)</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Локальна адреса відправника</th>
		<td valign=top nowrap>
		00E0F77F1920</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Мережева адреса відправника</th>
		<td valign=top nowrap>
		194.85. 135.65</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Локальна (шукана)<br>
		адреса одержувача</th>
		<td valign=top nowrap>
		008048ЕВ7Е60</td>
	</tr>
	<tr>
		<th nowrap align="left">
		Мережева адреса одержувача</th>
		<td valign=top nowrap>
		194.85. 135.75</td>
	</tr>
</table>
<p>Цю відповідь отримує
машина, що зробила ARP-запит. Модуль ARP аналізує ARP-відповідь і додає запис у
свою ARP-таблицю (табл. 5.8). У результаті обміну цими двома ARP-повідомленнями
модуль IP-вузла <nobr>194.85.135.75</nobr> визначив, що
IP-адресі <nobr>194.85.135.65</nobr> відповідає Мас-адреса
<nobr>00E0F77F1920</nobr>. Новий запис в ARP-таблиці
з'являється автоматично, через декілька мілісекунд після того, як вона була потрібна.</p>
<table border=1 cellpadding=0 width="100%">
	<caption style="text-align: left">&nbsp;Таблиця 5.8. Обновлена ARP-таблиця</caption>
	<tr>
		<th valign=top nowrap>
		IP-адреса</th>
		<th valign=top nowrap>
		МАС-адреса</th>
		<th valign=top nowrap>
		Тип запису</th>
	</tr>
	<tr>
		<td valign=top nowrap>
		194.85. 135.75 </td>
		<td valign=top nowrap>
		008048ЕВ7Е60 </td>
		<td valign=top nowrap>
		Динамічний </td>
	</tr>
	<tr>
		<td valign=top nowrap>
		194.85. 135.70 </td>
		<td valign=top nowrap>
		08005А21А722 </td>
		<td valign=top nowrap>
		Динамічний </td>
	</tr>
	<tr>
		<td valign=top nowrap>
		194.85.60.21 </td>
		<td valign=top nowrap>
		008048ЕВ7567 </td>
		<td valign=top nowrap>
		Статичний</td>
	</tr>
	<tr>
		<td valign=top nowrap>
		194.85. 135.65 </td>
		<td valign=top nowrap>
		00E0F77F1920 </td>
		<td valign=top nowrap>
		Динамічний </td>
	</tr>
</table>
<table border="0" cellpadding="2" cellspacing="3" width="100%" id="table1">
	<tr>
		<td><img border="0" src="images/znak.gif" width="36" height="35"></td>
		<td><i>Деякі реалізації IP й ARP не
ставлять IP-пакети в чергу на час очікування
ARP-відповідей. Замість цього IP-пакет просто знищується, а його відновлення покладається на модуль TCP або
прикладний процес, що працює через UDP. Таке відновлення
виконується за допомогою тайм-аутів і повторних передач. Повторна передача
повідомлення проходить успішно, тому що перша спроба вже спричинила заповнення ARP-таблиці.</i></td>
	</tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="table1">
  <tr>
    <td width="100%" align="left" colspan="3"><hr color="#2D4C54" size="4"></td>
  </tr>
  <tr>
    <td width="33%" align="left"><a href="013.htm">Попередня</a></td>
    <td width="33%" align="center"><a href="001.htm">Перша</a></td>
    <td width="34%" align="right"><a href="015.htm">Наступна</a></td>
  </tr>
</table></body>
</html>
