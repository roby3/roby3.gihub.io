<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta http-equiv="Content-Language" content="uk">
<link rel=Edit-Time-Data href=../tmp/vol5_4_2_u.files/editdata.mso>
<title>5.4.2. Дистанційно-векторний протокол RIP</title>
</head>
<body>
<h3>5.4.2. Дистанційно-векторний
протокол RIP</h3>
<h4>Побудова таблиці маршрутизації</h4>
<p>Протокол RIP (Routing Information
Protocol) є внутрішнім протоколом
маршрутизації дистанційно-векторного типу, він являє собою один з найбільш ранніх протоколів обміну маршрутною
інформацією й дотепер надзвичайно розповсюджений
в обчислювальних мережах через простоту
реалізації. Крім версії RIP для мереж TCP/IP
існує також версія RIP для мереж IPX/SPX
компанії Novell.</p>
<p>Для IP є дві версії протоколу
RIP: перша й друга. Протокол RIPv1 не підтримує масок, тобто він розповсюджує між маршрутизаторами тільки інформацію
про номери мереж і відстані до них, а
інформацію про маски цих мереж не розповсюджує, вважаючи,
що всі адреси належать до стандартних класів <b>А</b>, <b>В</b> або <b>С</b>. Протокол RIPv2 передає інформацію
про маски мереж, тому він більшою мірою
відповідає вимогам сьогоднішнього дня. Тому що при побудові таблиць
маршрутизації робота версії 2 принципово не відрізняється
від версії 1, то надалі для спрощення записів буде описуватися робота першої
версії.</p>
<p>Як відстань до мережі стандарти протоколу RIP допускають різні види метрик: хопи, метрики, що враховують пропускну здатність, внесені затримки й надійність мереж (тобто відповідним ознакам D, Т и R у полі «Якість сервісу» IP-пакета), а також будь-які комбінації
цих метрик. Метрика повинна мати властивість адитивності
- метрика складеного шляху
повинна дорівнювати сумі метрик складового цього шляху.
У більшості реалізацій RIP використовується
найпростіша метрика - кількість хопів, тобто
кількість проміжних маршрутизаторів, які потрібно пройти пакету до мережі
призначення.</p>
<p>Розглянемо процес побудови таблиці маршрутизації за
допомогою протоколу RIP на прикладі складеної мережі, зображеної
на мал. 5.26.</p>
<p><b>Етап 1 - створення мінімальних таблиць</b></p>
<p>У цій мережі
є вісім IP-мереж, зв'язаних чотирма
маршрутизаторами з ідентифікаторами: <b>Ml</b>, <b>М2</b>, <b>М3</b> і <b>М4</b>. Маршрутизатори, що
працюють за протоколом RIP, можуть мати
ідентифікатори, однак для роботи протоколу вони не є
необхідними. В RIP-повідомленнях ці ідентифікатори не передаються.</p>
<table border="0" width="100%" id="table1">
	<tr>
		<td align="center">
<img width=522 height=404
src=images/im026.jpg v:shapes=_x0000_i1025 alt="Мал. 5.26. Мережа, об'єднана RIP-моршрутизаторами"></td>
	</tr>
	<tr>
		<td align="center">Мал. 5.26. Мережа, об'єднана RIP-моршрутизаторами</td>
	</tr>
</table>
<p>У вихідному стані в кожному
маршрутизаторі програмним забезпеченням стека TCP/IP автоматично створюється
мінімальна таблиця маршрутизації, в якій враховуються тільки безпосередньо
приєднані мережі. На малюнку
адреси портів маршрутизаторів на відміну від адрес мереж
поміщені в овали.</p>
<p>Таблиця 5.14 дозволяє оцінити
зразковий вид мінімальної таблиці маршрутизації маршрутизатора <b>M1</b>.</p>
<table border=2 cellpadding=0 width="100%" bordercolorlight="#C0C0C0" bordercolordark="#808080" bordercolor="#C0C0C0">
	<caption>
	<p align="left">Таблиці 5.14. Мінімальна таблиця
маршрутизації маршрутизатора <b>M1</b></p>
	</caption>
	<tr>
		<th valign=top nowrap bgcolor="#95B3A4">
		Номер мережі</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Адреса наступного маршрутизатора</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Порт</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Відстань</th>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		201.36.14.0</td>
		<td valign=top bgcolor="#CFFCEF">
		201.36.14.3</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0.7</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		194.27.18.0</td>
		<td valign=top bgcolor="#CFFCEF">
		194.27.18.1</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	</table>
<p>Мінімальні таблиці маршрутизації
в інших маршрутизаторах будуть виглядати відповідно, наприклад, таблиця
маршрутизатора <b>М2</b> буде складатися із трьох записів (табл. 5.15).</p>
<table border=2 cellspacing=1 cellpadding=0 width="100%" bordercolorlight="#C0C0C0" bordercolordark="#808080" bordercolor="#C0C0C0">
	<caption style="text-align: left">Таблиця 5.15. Мінімальна таблиця
маршрутизації маршрутизатора <b>М2</b></caption>
	<tr>
		<th valign=top nowrap bgcolor="#95B3A4">
		Номер мережі</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Адреса наступного маршрутизатора</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Порт</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Відстань</th>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0. 101</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.17. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.17. 0.1</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.15. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.15. 0.6</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	</table>
<p><b>Етап 2 - розсилання мінімальних таблиць сусідам</b></p>
<p>Після ініціалізації кожного
маршрутизатора він починає посилати своїм сусідам повідомлення протоколу RIP, у
яких міститься його мінімальна таблиця.</p>
<p>RIP-повідомлення передаються в
пакетах протоколу UDP і включають два
параметри для кожної мережі: її IP-адреса й відстань до неї
від маршрутизатора, який передає повідомлення.</p>
<p>Сусідами є
ті маршрутизатори, яким даний маршрутизатор безпосередньо може передати
IP-пакет по якій-небудь своїй мережі, не
користуючись послугами проміжних маршрутизаторів. Наприклад, для маршрутизатора
<b>M1</b> сусідами є
маршрутизатори <b>М2</b> і <b>М3</b>, а
для маршрутизатора <b>М4</b> -
маршрутизатори <b>М2</b> і <b>М3</b>.</p>
<p>Таким чином, маршрутизатор <b>M1</b> передає маршрутизатору
<b>М2</b> і <b>М3</b> наступне повідомлення:<br><br>мережа 201.36.14.0, відстань 1;<br>мережа 132.11.0.0, відстань 1;<br>мережа 194.27.18.0, відстань 1.</p>
<p><b>Етап 3 - одержання RIP-повідомлень від сусідів і обробка отриманої
інформації</b></p>
<p>Після одержання аналогічних
повідомлень від маршрутизаторів <b>М2</b> і
<b>М3</b>
маршрутизатор <b>M1</b> нарощує кожне
отримане поле метрики на одиницю й запам'ятовує, через який порт і від якого
маршрутизатора отримана нова інформація (адреса цього маршрутизатора буде
адресою наступного маршрутизатора, якщо цей запис буде внесена в таблицю
маршрутизації). Потім маршрутизатор починає порівнювати нову інформацію з тієї, котра
зберігається в його таблиці маршрутизації
(табл. 5.16).</p>
<table border=2 cellpadding=0 width="100%" bordercolorlight="#C0C0C0" bordercolordark="#808080" bordercolor="#C0C0C0">
	<caption style="text-align: left">Таблиця 5.16. Таблиця маршрутизації
маршрутизатора <b>M1</b></caption>
	<tr>
		<th valign=top nowrap bgcolor="#95B3A4">
		Номер мережі</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Адреса наступного маршрутизатора</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Порт</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Відстань</th>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		201.36.14.0</td>
		<td valign=top bgcolor="#CFFCEF">
		201.36.14.3</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0.7</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		194.27.18.0</td>
		<td valign=top bgcolor="#CFFCEF">
		194.27.18.1</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.17. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0. 101</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.15. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0. 101</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		202. 101.15.0 </td>
		<td valign=top bgcolor="#CFFCEF">
		194.27.18.51</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		<s>132.11. 0.0</s></td>
		<td valign=top bgcolor="#CFFCEF">
		<s>132.11. 0. 101</s></td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		<s>1-94.27.10. 0</s></td>
		<td valign=top bgcolor="#CFFCEF">
		<s>194.27.10.51</s></td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		194.27.19.0</td>
		<td valign=top bgcolor="#CFFCEF">
		194.27.18.51</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
	</tr>
	</table>
<p>Записи із четвертого
по дев'ятий отримані від сусідніх маршрутизаторів, і вони претендують на поміщення
в таблицю. Однак тільки записи із четвертого по сьомий попадають
у таблицю, а записи восьмий й дев'ятий - ні.
Це відбувається тому, що вони містять дані про уже наявні у таблиці M1 мережі,
а відстань до них гірше, ніж в існуючих записах.</p>
<p>Протокол RIP заміщає запис про
яку-небудь мережу тільки в тому випадку, якщо
нова інформація має кращу метрику (відстань у хопах
менше), чим наявна. У результаті в таблиці маршрутизації про кожну мережу залишається
тільки один запис; якщо ж є трохи рівнозначних відносно відстані шляхів до однієї й
тій же мережі, то однаково в таблиці залишається
один запис, що прийшов в маршрутизатор першим
за часом. Для цього правила існує виключення -
якщо гірша інформація про яку-небудь мережу
прийшла від того ж маршрутизатора, на підставі повідомлення якого була створений
даний запис, то гірша інформація заміщає кращу.</p>
<p>Аналогічні операції з новою інформацією виконують і інші маршрутизатори мережі.</p>
<p><b>Етап 4 - розсилання нової, уже не мінімальної, таблиці сусідам</b></p>
<p>Кожний маршрутизатор відсилає нове RIP-повідомлення
всім своїм сусідам. У цьому повідомленні він
поміщає дані про всі відомі
йому мережі - як безпосередньо підключених, так і віддалених,
про які маршрутизатор довідався з RIP-повідомлень.</p>
<p><b>Етап 5 - одержання RIP-повідомлень від сусідів і обробка отриманої
інформації</b></p>
<p>Етап 5 повторює етап 3 -
маршрутизатори приймають RIP-повідомлення, обробляють інформацію, що міститься в них, і на її підставі
коректують свої таблиці маршрутизації.</p>
<p>Подивимося, як це робить
маршрутизатор <b>Ml</b> (табл. 5.17).</p>
<table border=2 cellspacing=1 cellpadding=0 width="100%" bordercolorlight="#C0C0C0" bordercolordark="#808080" bordercolor="#C0C0C0">
	<caption style="text-align: left">Таблиця 5.17. Таблиця маршрутизації
маршрутизатора <b>Ml</b></caption>
	<tr>
		<th valign=top nowrap bgcolor="#95B3A4">
		Номер мережі</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Адреса наступного маршрутизатора</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Порт</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Відстань</th>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		201.36.14.0</td>
		<td valign=top bgcolor="#CFFCEF">
		201.36.14.3</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0.7</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		194.27.18.0</td>
		<td valign=top bgcolor="#CFFCEF">
		194.27.18.1</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.15. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0. 101</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		<s>132.15. 0.0 </s></td>
		<td valign=top bgcolor="#CFFCEF">
		<s>194.27.10.51 </s></td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		194.27.19.0</td>
		<td valign=top bgcolor="#CFFCEF">
		194.27.18.51 </td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		<s>194.27.19.0</s></td>
		<td valign=top bgcolor="#CFFCEF">
		<s>132.11. 0. 101</s></td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		202. 101.16.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0. 101</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		<s>202. 101.16.0</s></td>
		<td valign=top bgcolor="#CFFCEF">
		<s>194.27.10.51</s></td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		132.17. 0.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0. 101</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
	</tr>
	</table>
<p>Ha цьому етапі
маршрутизатор <b>M1</b> одержав від маршрутизатора <b>М3</b> інформацію про мережу 132.15.0.0, яку той
у свою чергу на попередньому циклі роботи одержав
від маршрутизатора <b>М4</b>. Маршрутизатор
уже знає про мережу 132.15.0.0, причому стара
інформація має кращу метрику, ніж нова, тому
нова інформація про цю мережу відкидається.</p>
<p>Про мережу
202.101.16.0 маршрутизатор <b>M1</b> довідується на цьому етапі вперше, причому дані про
неї приходять від двох сусідів - від <b>МЗ</b> і <b>М4</b>.
Оскільки метрики в цих повідомленнях зазначені
однакові, то в таблицю попадають дані, які прийшли
першими. У нашому прикладі вважається, що
маршрутизатор <b>М2</b> випередив
маршрутизатор <b>М3</b>
і першим переслав своє RIP-повідомлення маршрутизатору <b>Ml</b>.</p>
<p>Якщо маршрутизатори періодично
повторюють етапи розсилання й обробки RIP-повідомлень, то за кінцевий час у мережі встановиться коректний режим маршрутизації.
Під коректним режимом маршрутизації тут розуміється такий стан таблиць маршрутизації, коли всі мережі будуть досяжні з будь-якої мережі за допомогою деякого раціонального маршруту.
Пакети будуть доходити до адресатів і не зациклюватися
в петлях, подібних тій,
котра утвориться на мал. 5.26, маршрутизаторами <b>М1-М2-М3-М4</b>.</p>
<p>Очевидно, якщо в мережі всі маршрутизатори, їхні інтерфейси й
з'єднуючі їхні канали зв'язку постійно
працездатні, то оголошення по протоколу RIP
можна робити досить рідко, наприклад, один раз у день. Однак у мережах постійно відбуваються
зміни - змінюється як працездатність маршрутизаторів і каналів, так і самі
маршрутизатори й канали можуть додаватися в існуючу мережу
або ж виводитися з її складу.</p>
<p>Для адаптації до змін у мережі протокол RIP використовує
ряд механізмів.</p>
<h4>Адаптація RIP-маршрутизаторів до
змін стану мережі</h4>
<p>До нових маршрутів
RIP-маршрутизатори пристосовуються просто - вони передають нову інформацію в черговому повідомленні своїм сусідам і поступово ця
інформація стає відома всім маршрутизаторам мережі.
А от до негативних змін, пов'язаних із втратою
якого-небудь маршруту, RIP-маршрутизатори пристосовуються складніше. Це
пов'язане з тим, що у форматі повідомлень протоколу RIP немає поля, яке б вказувало на те, що шлях
до даної мережі більше не існує.</p>
<p>Замість цього використовуються два механізми повідомлення про те,
що деякий маршрут більше недійсний: </p>
<ul type=disc>
	<li>закінчення часу життя маршруту;</li>
	<li>вказівка спеціальної відстані (нескінченності) до мережі, що стала недоступною.</li>
</ul>
<p>Для відпрацьовування першого
механізму кожен запис таблиці маршрутизації
(як і записи таблиці просування моста/комутатора), отриманий по протоколу RIP, має час життя (TTL). При надходженні
чергового RIP-повідомлення, що підтверджує справедливість даного запису, таймер
TTL встановлюється у вихідний стан, а потім з нього щосекунди віднімається одиниця. Якщо за час тайм-ауту не
прийде нове маршрутне повідомлення про цей маршрут, то він позначається як недійсний.</p>
<p>Час тайм-ауту пов'язаний з
періодом розсилання векторів по мережі. В RIP
IP період розсилання обраний рівним 30&nbsp;секундам,
а як тайм-аут обране шестиразове значення періоду розсилання, тобто 180&nbsp;секунд.
Вибір досить малого часу періоду розсилання пояснюється
декількома причинами, які стануть зрозумілі з
подальшого викладу. Шестиразовий запас часу потрібний для впевненості в тому, що мережа
дійсно стала недоступна, а не просто відбулися втрати RIP-повідомлень (а це
можливо, тому що RIP використовує транспортний
протокол UDP, що не забезпечує надійної доставки повідомлень).</p>
<p>Якщо який-небудь маршрутизатор
відмовляє й перестає слати своїм сусідам повідомлення про мережі, які можна досягти через нього, то через 180
секунд всі записи, які породив цей маршрутизатор, стануть недійсними в його найближчих сусідів. Після цього процес
повториться вже для сусідів найближчих сусідів - вони викреслять подібні записи
вже через 360&nbsp;секунд, тому що перші 180&nbsp;секунд
найближчі сусіди ще передавали повідомлення про ці записи.</p>
<p>Як видно з пояснення, відомості про недоступні через маршрутизатор, який
відмовив, мережі поширюються
по мережі не дуже швидко, час поширення кратний часу
життя запису, а коефіцієнт кратності дорівнює
кількості хопів між самими далекими маршрутизаторами мережі.
У цьому полягає
одна із причин вибору як періоду розсилання невеликої величини
в 30&nbsp;секунд.</p>
<p>Якщо відмовляє не маршрутизатор,
а інтерфейс або мережа, що зв'язують його з яким-небудь сусідом, то ситуація зводиться до
тільки що описаного - знову починає працювати механізм тайм-ауту й маршрути, що
стали недійсними, поступово будуть викреслені з таблиць всіх маршрутизаторів мережі.</p>
<p>Тайм-аут працює в тих випадках,
коли маршрутизатор не може послати сусідам повідомлення про маршрут, що
відмовив, тому що або він сам непрацездатний,
або непрацездатна лінія зв'язку, по якій можна було б передати повідомлення.</p>
<p>Коли ж повідомлення послати
можна, RIP-маршрутизатори не використовують
спеціальну ознаку в повідомленні, а вказують нескінченну
відстань до мережі, причому в протоколі RIP
вона обрана рівною 16&nbsp;хопам (при іншій метриці необхідно вказати маршрутизатору її значення, яке вважається нескінченністю). Одержавши
повідомлення, у якому деяка мережа
супроводжується відстанню 16 (або 15, що приводить до того ж результату, тому
що маршрутизатор нарощує отримане значення на 1), маршрутизатор повинен
перевірити, чи виходить ця «погана» інформація
про мережу від того ж маршрутизатора,
повідомлення якого послужило у свій час підставою
для запису про дану мережу в таблиці маршрутизації. Якщо це той же маршрутизатор,
то інформація вважається достовірною й маршрут позначається як недоступний.</p>
<p>Таке невелике значення «нескінченної» відстані викликане тим, що в деяких
випадках відмови зв'язків у мережі викликають тривалі періоди некоректної роботи
RIP-маршрутизаторів, що виражається в зацикленні пакетів у петлях мережі. І чим менше відстань, використовувана в
якості «нескінченної», тим такі періоди стають
коротше.</p>
<p>Розглянемо випадок зациклення пакетів на прикладі мережі, зображеної
на мал. 5.26.</p>
<p>Нехай маршрутизатор <b>M1</b> виявив,
що його зв'язок з
безпосередньо підключеною мережею 201.36.14.0
загублено (наприклад, через відмову інтерфейсу 201.36.14.3). <b>M1</b> відзначив у своїй таблиці маршрутизації, що мережа
201.36.14.0 недоступна. У найгіршому разі він виявив
це відразу ж після відправлення чергових RIP-повідомлень, так що до початку
нового циклу його оголошень, у якому він повинен повідомити сусідам, що
відстань до мережі 201.36.14.0 стала дорівнювати 16, залишається
майже 30 секунд.</p>
<p>Кожний маршрутизатор працює на підставі свого
внутрішнього таймера, не синхронізуючи роботу з розсилання оголошень із іншими
маршрутизаторами. Тому досить імовірно,
маршрутизатор <b>М2</b> випередив
маршрутизатор <b>M1</b> і передав йому своє
повідомлення раніше, ніж <b>M1</b> встиг переказати новину про
недосяжність мережі 201.36.14.0. А в цьому повідомленні є дані, породжені
наступним записом у таблиці маршрутизації <b>М2</b> (табл. 5.18).</p>
<table border=2 cellpadding=0 width="100%" bordercolorlight="#C0C0C0" bordercolordark="#808080" bordercolor="#C0C0C0">
	<caption style="text-align: left">Таблиця 5.18. Таблиця маршрутизації
маршрутизатора <b>М2</b></caption>
	<tr>
		<th valign=top nowrap bgcolor="#95B3A4">
		Номер мережі</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Адреса наступному маршрутизаторі</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Порт</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Відстань</th>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		201.36.14.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0.7</td>
		<td valign=top bgcolor="#CFFCEF">
		1</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
	</tr>
</table>
<p>Цей запис був отриманий від
маршрутизатора <b>M1</b> і коректний до
відмови інтерфейсу 201.36.14.3, а тепер вона застаріла, але маршрутизатор <b>М2</b> про це
не довідався.</p>
<p>Тепер маршрутизатор <b>M1</b> одержав
нову інформацію про мережу 201.36.14.0 - ця мережа досяжна через маршрутизатор 
<b>М2</b> з
метрикою 2. Раніше <b>M1</b> також одержував цю інформацію
від <b>М2</b>. Але ігнорував її, тому що його власна метрика для 201.36.14.0 була
краще. Тепер <b>M1</b> повинен прийняти
дані про мережу 201.36.14.0, отримані від <b>М2</b>,
і замінити запис у таблиці маршрутизації про
недосяжність цієї мережі (табл. 5.19).</p>
<table border=2 cellpadding=0 width="100%" bordercolorlight="#C0C0C0" bordercolordark="#808080" bordercolor="#C0C0C0" id="table2">
	<caption style="text-align: left">Таблиця 5.19. Таблиця маршрутизації маршрутизатора 
	<b>M1</b></caption>
	<tr>
		<th valign=top nowrap bgcolor="#95B3A4">
		Номер мережі</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Адреса наступному маршрутизаторі</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Порт</th>
		<th valign=top nowrap bgcolor="#95B3A4">
		Відстань</th>
	</tr>
	<tr>
		<td valign=top bgcolor="#CFFCEF">
		201.36.14.0</td>
		<td valign=top bgcolor="#CFFCEF">
		132.11. 0.101</td>
		<td valign=top bgcolor="#CFFCEF">
		2</td>
		<td valign=top bgcolor="#CFFCEF">
		3</td>
	</tr>
</table>
<p>У результаті в мережі утворилася маршрутна петля: пакети, що направляють вузлам мережі
201.36.14.0, будуть передаватися маршрутизатором <b>М2</b> маршрутизатору <b>M1</b>, а маршрутизатор 
<b>M1</b> буде повертати їхньому маршрутизатору <b>М2</b>.
IP-пакети будуть циркулювати по цій петлі доти, поки не мине час життя кожного пакета.</p>
<p>Маршрутна петля буде існувати в мережі досить довго. Розглянемо
періоди часу, кратні часу
життя записів у таблицях маршрутизаторів.</p>
<ul type=disc>
	<li>Час 0-180 с. Після відмови інтерфейсу в маршрутизаторах <b>M1</b> і <b>М2</b> будуть зберігатися некоректні записи, наведені вище. Маршрутизатор 
	<b>М2</b> як і раніше постачає маршрутизатор <b>M1</b> своїм записом про мережу 201.36.14.0 з метрикою 2, тому що її час життя не минув. Пакети зациклюються.</li>
	<li>Час 180-360 с. На початку цього періоду в маршрутизаторі <b>М2</b> минає час життя запису про мережу 201.36.14.0 з метрикою 2, тому що маршрутизатор 
	<b>M1</b> у попередній період посилав йому повідомлення про мережу 201.36.14.0 з гіршою метрикою, чим у 
	<b>М2</b>, і вони не могли підтверджувати цей запис. Тепер маршрутизатор <b>М2</b> приймає від маршрутизатора 
	<b>M1</b> запис про мережу 201.36.14.0 з метрикою 3 і трансформує її в запис із метрикою 4. Маршрутизатор 
	<b>M1</b> не отримує нових повідомлень від маршрутизатора <b>М2</b> про мережу 201.36.14.0 з метрикою 2, тому час життя його запису починає зменшуватися. Пакети продовжують зациклюватися.</li>
	<li>Час 360-540 с. Тепер у маршрутизатора <b>M1</b> минає час життя запису про мережу 201.36.14.0 з метрикою 3. Маршрутизатори 
	<b>M1</b> і <b>М2</b> знову міняються ролями - <b>М2</b> постачає <b>M1</b> застарілою інформацією про шлях до мережі 201.36.14.0, уже з метрикою 4, що 
	<b>M1</b> перетворить у метрику 5. Пакети продовжують зациклюватися.</li>
</ul>
<p>Якби в протоколі RIP не була
обрана відстань 16 у якості недосяжної, то
описаний процес тривав би нескінченно (вірніше, поки не була б вичерпана
розрядна сітка поля відстані й не було б зафіксоване переповнення при черговому нарощуванні відстані).</p>
<p>У результаті маршрутизатор <b>М2</b> на черговому етапі описаного процесу
отримує від маршрутизатора <b>M1</b> метрику 15, що після нарощування,
перетворюючись у метрику 16, фіксує недосяжність мережі.
Період нестабільної роботи мережі тривав 36
хвилин!</p>
<p>Обмеження в 15&nbsp;хопів звужує область
застосування протоколу RLP до мереж, у яких
число проміжних маршрутизаторів не може бути більше 15. Для більш масштабних мереж
потрібно застосовувати інші протоколи маршрутизації, наприклад OSPF, або
розбивати мережу на автономні області.</p>
<p>Наведений приклад добре ілюструє головну причину
нестабільної роботи маршрутизаторів, що працюють за протоколом
RIP. Ця причина корениться в самому принципі роботи дистанційно-векторних
протоколів - використанні інформації, отриманій із других рук. Дійсно, маршрутизатор 
<b>М2</b> передав маршрутизатору
<b>M1</b> інформацію про досяжність мережі 201.36.14.0, за вірогідність якої він сам не відповідає. Викорінити цю причину повністю не можна, адже сам спосіб побудови таблиць
маршрутизації пов'язаний з передачею чужої інформації без вказівки джерела її походження.</p>
<p>Не слід думати, що при будь-яких
відмовах інтерфейсів і маршрутизаторів у мережах
виникають маршрутні петлі. Якби маршрутизатор <b>M1</b> встиг передати повідомлення про
недосяжність мережі 201.36.14.0 раніше помилкової інформації маршрутизатора <b>М2</b>, то маршрутна петля не утворилася б.
Так що маршрутні петлі навіть без додаткових методів боротьби з ними, описаними в наступному розділі, виникають у середньому
не більш ніж у половині потенційно можливих випадків.</p>
<h4>Методи боротьби з помилковими маршрутами в протоколі RIP</h4>
<p>Незважаючи на те що протокол RIP
не в змозі повністю виключити перехідні стани в мережі,
коли деякі маршрутизатори користуються застарілою інформацією про вже неіснуючі
маршрути, є кілька методів, які в багатьох випадках вирішують подібні проблеми.</p>
<p>Ситуація з
петлею, що утвориться між сусідніми маршрутизаторами, описана в попередньому розділі, надійно вирішується
за допомогою методу, який отримав назву <b><i>розщеплення
горизонту</i></b> (<b><i>split horizon</i></b>). Метод
полягає в тому,
що маршрутна інформація про деяку мережу, що
зберігається в таблиці маршрутизації, ніколи
не передається тому маршрутизатору, від якого
вона отримана (це наступний маршрутизатор у даному маршруті). Якщо
маршрутизатор <b>М2</b> у розглянутому вище
прикладі підтримує техніку розщеплення горизонту,
то він не передасть маршрутизатору <b>M1</b> застарілу інформацію про мережу 201.36.14.0, тому що одержав
її саме від маршрутизатора <b>M1</b>.</p>
<p>Практично всі сьогоднішні
маршрутизатори, що працюють за протоколом RIP,
використовують техніку розщеплення горизонту.</p>
<p>Однак розщеплення горизонту не допомагає в тих випадках, коли петлі
утворяться не двома, а декількома
маршрутизаторами. Розглянемо більш детально
ситуацію, що виникне в мережі, наведеній на мал. 5.26, у випадку втрати зв'язку маршрутизатора 
<b>M1</b> з мережею
129.36.14. 0. Нехай всі маршрутизатори цієї мережі
підтримують техніку розщеплення горизонту.
Маршрутизатори <b>М2</b> і <b>М3</b> не
будуть повертати маршрутизатору в цій ситуації
дані про мережу 201.36.14. 0 з<i></i>метрикою
2, тому що вони одержали цю інформацію від
маршрутизатора <b>M1</b>. Однак вони будуть
передавати маршрутизатору інформацію про
досяжність мережі 201.36.14.0 з метрикою 4 через себе, тому що одержали цю інформацію зі складного маршруту, а не
від маршрутизатора <b>M1</b> безпосередньо.
Наприклад, маршрутизатор <b>М2</b> одержав цю інформацію з ланцюжка <b>М4-МЗ-М1</b>. Тому маршрутизатор 
<b>М1</b> знову може бути обманутий, поки кожний з маршрутизаторів у ланцюжку <b>М3-М4-М2</b> не викреслить запис про
досяжність <b>мережі
1</b> (а це відбудеться через період 3&nbsp;х&nbsp;180
секунд).</p>
<p>Для запобігання зациклення
пакетів у складених петлях при відмовах зв'язків застосовуються два інших прийоми, які називаються
<b><i>тригерними
відновленнями</i></b> (<b><i>triggered updates</i></b>) і
<b><i>заморожуванням змін</i></b> (<b><i>hold
down</i></b>).</p>
<p>Спосіб тригерних
відновлень полягає в тому, що маршрутизатор, одержавши дані про зміну метрики до якої-небудь мережі, не чекає витікання
періоду передачі таблиці маршрутизації, а передає дані про маршрут, що
змінився, негайно. Цей прийом може в багатьох
випадках запобігти передачі застарілих відомостей
про маршрут, що відмовив, але він перевантажує мережу
службовими повідомленнями, тому тригерні
оголошення також робляться з деякою затримкою.
Тому можлива ситуація, коли регулярне відновлення
в якому-небудь маршрутизаторі ледве випередить
за часом прихід тригерного
відновлення від попередніх
в ланцюжку маршрутизатора й даний маршрутизатор встигне передати по мережі застарілу інформацію про неіснуючий маршрут.</p>
<p>Другий прийом
дозволяє виключити подібні ситуації. Він пов'язаний із введенням
тайм-ауту на прийняття нових даних про мережу,
що тільки що стала недоступною. Цей тайм-аут
запобігає прийняття застарілих відомостей про якийсь маршрут від
тих маршрутизаторів, які перебувають на деякій
відстані від зв'язку, що відмовив, і передають
застарілі відомості про його працездатність. Передбачається, що протягом тайм-ауту «заморожування
змін» ці маршрутизатори викреслять даний маршрут зі своїх таблиць, тому що не отримають про нього
нових записів і не будуть поширювати застарілі
відомості по мережі.</p>
<table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse" bordercolor="#111111" width="100%" id="table1">
  <tr>
    <td width="100%" align="left" colspan="3"><hr color="#2D4C54" size="4"></td>
  </tr>
  <tr>
    <td width="33%" align="left"><a href="025.htm">Попередня</a></td>
    <td width="33%" align="center"><a href="001.htm">Перша</a></td>
    <td width="34%" align="right">Наступна</td>
  </tr>
</table></body>
</html>
